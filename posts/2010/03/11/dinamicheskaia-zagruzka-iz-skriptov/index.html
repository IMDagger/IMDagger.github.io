<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <title>Динамическая загрузка из скриптов</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta name="author" content="Alex Moiseenko" />
        <!-- Open Graph -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="stylesheet" href="/theme/css/html4css1.css" />
        <link rel="stylesheet" href="/theme/css/style.css" />
        <link rel="stylesheet" href="/theme/css/pygment.css" />
        <link rel="stylesheet" href="/theme/css/math.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script type="text/x-mathjax-config">
         MathJax.Hub.Config({
             'HTML-CSS': {
                 linebreaks: {
                     automatic: true,
                     width: 'container'
                 }
             },
             tex2jax: {
                 inlineMath: [['$math$','$/math$']],
                 displayMath: [['$$math$$','$$/math$$']],
                 skipTags: ['pre', 'code'],
                 preview: ['формула...'],
                 ignoreClass: 'math-ignore'
             }
         });
        </script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>


        <script src="http://s3.amazonaws.com/nwapi/nwmatcher/nwmatcher-1.2.5-min.js"></script>
        <!--[if (gte IE 6)&(lte IE 8)]>
          <script type="text/javascript" src="/theme/js/selectivizr-min.js"></script>
          <noscript><link rel="stylesheet" href="[fallback css]" /></noscript>
        <![endif]-->

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="row page-head">
            <div class="row page-head-status page-head-status-top"><div class="col-sm-12 b-status mine"><p><i></i><a href="#" title="настроение" class="b-consistent-link"><b>ни к чему чужое мнение, в моде самовыражение</b></a></p></div></div>
            <div class="col-sm-2 page-left">
                <a href="#">
                    <img src="http://upics.yandex.ru/22199227/normal" ilo-full-src="http://upics.yandex.ru/22199227/normal">
                </a>
            </div>
            <div class="col-sm-10 all-posts">
                <div class="title-container">
                    <h1><b><a href="http://imdagger.github.io/" class="fn nickname">IMDagger</a></b></h1>
                </div>
                <div class="title-menu">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="active">
                            <a href="#">Дневник</a>
                        </li>
                        <li><a href="#">О себе</a></li>
                        <li><a href="#">Фотки</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row page-body">
<div class="col-sm-2 page-left">
<div class="row widget">
    <div class="widget-content">
        <div class="widget__title">
            <div class="widget__title-link">Популярное в дневнике</div>
        </div>
        <div class="widget__body">
            <div class="widget-line">
                <div class="widget-entry">
                    <div class="widget-day__title">25&nbsp;июня</div>
                    <div class="widget-entry clearfix">
                        <div class="widget-entry__item">
                            <div class="widget-entry__title">
                                <a href="#" class="h-link">&nbsp;&nbsp;&nbsp; Висцеральная теория сна выглядит стр…</a>
                            </div>
                            <div class="widget-entry__info">2&nbsp;ответа</div>
                        </div>
                    </div>
                </div>
                <div class="widget-entry">
                    <div class="widget-day__title">16&nbsp;мая</div>
                    <div class="widget-entry clearfix">
                        <div class="widget-entry__item">
                            <div class="widget-entry__title">
                                <a href="#" class="h-link">Пожалуй у ByFly сегодня даже более серьё…</a>
                            </div>
                            <div class="widget-entry__info">2&nbsp;ответа</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div></div>

<div class="col-sm-10 all-posts">
<div class="row b-post-filter">
    <span class="pull-right">
        записи по
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">месяцам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a href="#" class="h-link">Нулябрь</a><li>
                <li><a href="#" class="h-link">Первябрь</a><li>
            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">меткам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">                <li>                    <a class="tag-1" href="/tag/radost.html" class="h-link">радость</a>                    <a class="tag-2" href="/tag/sborka.html" class="h-link">сборка</a>                    <a class="tag-2" href="/tag/icfpc.html" class="h-link">icfpc</a>                    <a class="tag-1" href="/tag/ia.html" class="h-link">Я</a>                    <a class="tag-1" href="/tag/zhizn.html" class="h-link">жизнь</a>                </li>                <li>                    <a class="tag-1" href="/tag/rabota.html" class="h-link">работа</a>                    <a class="tag-2" href="/tag/bredni.html" class="h-link">бредни</a>                    <a class="tag-1" href="/tag/programmirovanie.html" class="h-link">программирование</a>                    <a class="tag-2" href="/tag/linux.html" class="h-link">linux</a>                    <a class="tag-2" href="/tag/javascript.html" class="h-link">javascript</a>                </li>                <li>                    <a class="tag-1" href="/tag/python.html" class="h-link">python</a>                    <a class="tag-2" href="/tag/emacs.html" class="h-link">emacs</a>                    <a class="tag-2" href="/tag/java.html" class="h-link">java</a>                    <a class="tag-2" href="/tag/eda.html" class="h-link">еда</a>                    <a class="tag-1" href="/tag/oshibka.html" class="h-link">ошибка</a>                </li>                <li>                    <a class="tag-1" href="/tag/blender.html" class="h-link">blender</a>                    <a class="tag-2" href="/tag/iandeks.html" class="h-link">Яндекс</a>                    <a class="tag-1" href="/tag/bge.html" class="h-link">bge</a>                    <a class="tag-1" href="/tag/nabrosok.html" class="h-link">набросок</a>                    <a class="tag-2" href="/tag/google.html" class="h-link">google</a>                </li>            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">типам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a href="/category/description.html" class="h-link">обращение</a><li>
                <li><a href="/category/friend.html" class="h-link"></a><li>
                <li><a href="/category/join.html" class="h-link"></a><li>
                <li><a href="/category/link.html" class="h-link">ссылки</a><li>
                <li><a href="/category/mood.html" class="h-link">настроение</a><li>
                <li><a href="/category/photo.html" class="h-link">фото</a><li>
                <li><a href="/category/text.html" class="h-link">текст</a><li>
                <li><a href="/category/video.html" class="h-link">видео</a><li>
                <li><a href="/category/wishlist.html" class="h-link"></a><li>
            </ul>
        </div>
    </span>
</div>    <div class="row b-post">
<div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2010/03/11/dinamicheskaia-zagruzka-iz-skriptov/" >
                11 марта 2010 года, 14:50
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2010/03/11/dinamicheskaia-zagruzka-iz-skriptov/">Динамическая загрузка из скриптов</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Добавил в BGE вызов функций отложенной загрузки объектов сцены из
другого blend-файла, а также функцию отложенной выгрузки. До этого можно
было лишь пользоваться актуатором:</p>
<div class="highlight"><pre><span class="pgcss-n">cc</span> <span class="pgcss-o">=</span> <span class="pgcss-n">GameLogic</span><span class="pgcss-o">.</span><span class="pgcss-n">getCurrentController</span><span class="pgcss-p">()</span>
<span class="pgcss-n">blend_loader</span> <span class="pgcss-o">=</span> <span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">actuators</span><span class="pgcss-p">[</span><span class="pgcss-s">&#39;load&#39;</span><span class="pgcss-p">]</span>
<span class="pgcss-n">blend_loader</span><span class="pgcss-o">.</span><span class="pgcss-n">scene</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&#39;Room stuff&#39;</span>
<span class="pgcss-n">room_number</span> <span class="pgcss-o">=</span> <span class="pgcss-mi">112</span>
<span class="pgcss-n">blend_loader</span><span class="pgcss-o">.</span><span class="pgcss-n">blendFileName</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&#39;//room</span><span class="pgcss-si">%s</span><span class="pgcss-s">/stuff/main.blend&#39;</span> <span class="pgcss-o">%</span> <span class="pgcss-n">room_number</span>
<span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">activate</span><span class="pgcss-p">(</span><span class="pgcss-n">blend_loader</span><span class="pgcss-p">)</span>
</pre></div>
<p>blend_loader загрузит сцену из файла с относительным путём
<strong>//room112/stuff/main.blend</strong>,&nbsp;<strong>blendFileName</strong> это свойство,
которое указывает имя файла. так способом можно загружать за одну
итерацию BGE только количество сцен равное количеству активированных
актуаторов. С выгрузкой аналогично. Такой подход может быть удобным,
если нужно по мере загрузки обновлять изображение на экране и
отрисовывать, например полосу прогресса загрузки.</p>
<p>Но бывает нужно за один подход загрузить несколько групп объектов.
Немноог напоминает транзакции из баз данных, т.е. ничего не должно
вклиниваться между загрузкой двух сцен, ни отрисовка, ни другие события
актуаторов или сенсоров. Эту проблему решит добавка отдельного API для
загрузки не через актуаторы:</p>
<div class="highlight"><pre><span class="pgcss-n">room_file_name</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&#39;//room</span><span class="pgcss-si">%s</span><span class="pgcss-s">/stuff/main.blend&#39;</span>
<span class="pgcss-n">room_number</span> <span class="pgcss-o">=</span> <span class="pgcss-mi">112</span>
<span class="pgcss-n">GameLogic</span><span class="pgcss-o">.</span><span class="pgcss-n">mergeBlendFile</span><span class="pgcss-p">(</span><span class="pgcss-s">&#39;Room Stuff&#39;</span><span class="pgcss-p">,</span> \
             <span class="pgcss-s">&#39;//room</span><span class="pgcss-si">%s</span><span class="pgcss-s">/stuff/main.blend&#39;</span> <span class="pgcss-o">%</span> <span class="pgcss-n">room_number</span><span class="pgcss-p">)</span>
 <span class="pgcss-n">room_number</span> <span class="pgcss-o">=</span> <span class="pgcss-mi">115</span>
 <span class="pgcss-n">GameLogic</span><span class="pgcss-o">.</span><span class="pgcss-n">unmergeBlendFile</span><span class="pgcss-p">(</span><span class="pgcss-s">&#39;Room Stuff&#39;</span><span class="pgcss-p">,</span> \
             <span class="pgcss-n">room_file_name</span> <span class="pgcss-o">%</span> <span class="pgcss-n">room_number</span><span class="pgcss-p">,</span> <span class="pgcss-bp">True</span><span class="pgcss-p">)</span>
</pre></div>
<p>Т.е. в сцену, где расположен объект, на котором исполняется данных
скрипт контроллера, добавить объекты из сцены&nbsp;Room
Stuff&nbsp;//room112/stuff/main.blend <u class="underline">
на следующей итерации</u>
. И тут же
потребовать выгрузки на следующей итерации сцены
из&nbsp;//room115/stuff/main.blend, True указывает, что это <strong>Forced</strong> режим
(когда BGE пробудет удалить и blend-файл из памяти, если никто его не
использует). False — обычный режим, BGE удаляет объекты, но blend-файл
оставляет в памяти, чтобы в следующий раз не считывать с диска (вдруг
его опять скоро попросят загрузиться).</p>
<p>Нужно учитывать, что загрузка и выгрузка происходят на новой
итерации, но… проверка при выгрузке происходит сразу. Т.е., если
попросить загрузить <strong>A</strong> и тут же попросить выгрузить <strong>A</strong>, то
загрузка будет (на новой итерации), а при выгрузке скажет, что файл ещё
не загрузился (сразу после исполнения функции).</p>
<p>Соберусь с силами и сделаю ещё один билд. Нужно подправить
функционал связанный с оверлеями :) Я рассчитываю его тоже включить в
сборку.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div>    </div>
</div>
        </div>
<!-- Yandex.Metrika informer --><a href="https://metrika.yandex.ru/stat/?id=25746494&amp;from=informer" target="_blank" rel="nofollow"><img src="//bs.yandex.ru/informer/25746494/3_1_FFFFFFFF_EFEFEFFF_0_pageviews" style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" onclick="try{Ya.Metrika.informer({i:this,id:25746494,lang:'ru'});return false}catch(e){}"/></a><!-- /Yandex.Metrika informer --><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter25746494 = new Ya.Metrika({id:25746494, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/25746494" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->    </body>
</html>