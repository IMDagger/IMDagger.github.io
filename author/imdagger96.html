<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <title>IMDagger - Articles by IMDagger</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta name="author" content="Alex Moiseenko" />
        <!-- Open Graph -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="stylesheet" href="/theme/css/html4css1.css" />
        <link rel="stylesheet" href="/theme/css/style.css" />
        <link rel="stylesheet" href="/theme/css/pygment.css" />
        <link rel="stylesheet" href="/theme/css/math.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script type="text/x-mathjax-config">
         MathJax.Hub.Config({
             'HTML-CSS': {
                 linebreaks: {
                     automatic: true,
                     width: 'container'
                 }
             },
             tex2jax: {
                 inlineMath: [['$math$','$/math$']],
                 displayMath: [['$$math$$','$$/math$$']],
                 skipTags: ['pre', 'code'],
                 preview: ['формула...'],
                 ignoreClass: 'math-ignore'
             }
         });
        </script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>


        <script src="http://s3.amazonaws.com/nwapi/nwmatcher/nwmatcher-1.2.5-min.js"></script>
        <!--[if (gte IE 6)&(lte IE 8)]>
          <script type="text/javascript" src="/theme/js/selectivizr-min.js"></script>
          <noscript><link rel="stylesheet" href="[fallback css]" /></noscript>
        <![endif]-->

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="row page-head">
            <div class="row page-head-status page-head-status-top"><div class="col-sm-12 b-status mine"><p><i></i><a href="#" title="настроение" class="b-consistent-link"><b>ни к чему чужое мнение, в моде самовыражение</b></a></p></div></div>
            <div class="col-sm-2 page-left">
                <a href="#">
                    <img src="http://upics.yandex.ru/22199227/normal" ilo-full-src="http://upics.yandex.ru/22199227/normal">
                </a>
            </div>
            <div class="col-sm-10 all-posts">
                <div class="title-container">
                    <h1><b><a href="http://imdagger.github.io/" class="fn nickname">IMDagger</a></b></h1>
                </div>
                <div class="title-menu">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="active">
                            <a href="#">Дневник</a>
                        </li>
                        <li><a href="#">О себе</a></li>
                        <li><a href="#">Фотки</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row page-body">
<div class="col-sm-2 page-left">
<div class="row widget widget-photo">
    <a href="posts/2011/08/07/aga-popalsia/" class="b-user-photo__link"><img class="b-user-photo__img" src=" http://img-fotki.yandex.ru/get/5409/22199227.a/0_625fc_e780ccc7_L
?log_nocount=64720402854"></a>
</div><div class="row widget">
    <div class="widget-content b-user-info">
        <div class="widget__body">
            <div class="widget-user-info__age">
                <i class="widget-user-info__sex widget-user-info__sex_type_"></i> 26&nbsp;лет
            </div>
            <div class="widget-user-info__place">
                <a href="#">Гомель</a>,                <a href="#">Беларусь</a>            </div>
            <ul class="contacts">
                <li class="contact contact-type-email"><i></i><a href="mailto:imdagger@yandex.ru">imdagger@yandex.ru</a></li>
                <li class="contact contact-type-ya-online"><i></i>imdagger@ya.ru</li>
                <li class="contact contact-type-icq"><i></i>350395088</li>
            </ul>
        </div>
    </div>
</div>

<div class="row widget">
    <div class="widget-content">
        <div class="widget__title">
            <div class="widget__title-link">Популярное в дневнике</div>
        </div>
        <div class="widget__body">
            <div class="widget-line">
                <div class="widget-entry">
                    <div class="widget-day__title">25&nbsp;июня</div>
                    <div class="widget-entry clearfix">
                        <div class="widget-entry__item">
                            <div class="widget-entry__title">
                                <a href="#" class="h-link">&nbsp;&nbsp;&nbsp; Висцеральная теория сна выглядит стр…</a>
                            </div>
                            <div class="widget-entry__info">2&nbsp;ответа</div>
                        </div>
                    </div>
                </div>
                <div class="widget-entry">
                    <div class="widget-day__title">16&nbsp;мая</div>
                    <div class="widget-entry clearfix">
                        <div class="widget-entry__item">
                            <div class="widget-entry__title">
                                <a href="#" class="h-link">Пожалуй у ByFly сегодня даже более серьё…</a>
                            </div>
                            <div class="widget-entry__info">2&nbsp;ответа</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div></div>

<div class="col-sm-10 all-posts">
<div class="row b-post-filter">
    <span class="pull-right">
        записи по
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">месяцам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a href="#" class="h-link">Нулябрь</a><li>
                <li><a href="#" class="h-link">Первябрь</a><li>
            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">меткам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">                <li>                    <a class="tag-2" href="/tag/linux.html" class="h-link">linux</a>                    <a class="tag-2" href="/tag/iandeks.html" class="h-link">Яндекс</a>                    <a class="tag-1" href="/tag/oshibka.html" class="h-link">ошибка</a>                    <a class="tag-1" href="/tag/bge.html" class="h-link">bge</a>                    <a class="tag-2" href="/tag/eda.html" class="h-link">еда</a>                </li>                <li>                    <a class="tag-1" href="/tag/rabota.html" class="h-link">работа</a>                    <a class="tag-2" href="/tag/sborka.html" class="h-link">сборка</a>                    <a class="tag-1" href="/tag/blender.html" class="h-link">blender</a>                    <a class="tag-1" href="/tag/programmirovanie.html" class="h-link">программирование</a>                    <a class="tag-1" href="/tag/radost.html" class="h-link">радость</a>                </li>                <li>                    <a class="tag-2" href="/tag/emacs.html" class="h-link">emacs</a>                    <a class="tag-1" href="/tag/ia.html" class="h-link">Я</a>                    <a class="tag-1" href="/tag/zhizn.html" class="h-link">жизнь</a>                    <a class="tag-2" href="/tag/bredni.html" class="h-link">бредни</a>                    <a class="tag-2" href="/tag/java.html" class="h-link">java</a>                </li>                <li>                    <a class="tag-2" href="/tag/google.html" class="h-link">google</a>                    <a class="tag-1" href="/tag/nabrosok.html" class="h-link">набросок</a>                    <a class="tag-1" href="/tag/python.html" class="h-link">python</a>                    <a class="tag-2" href="/tag/javascript.html" class="h-link">javascript</a>                    <a class="tag-2" href="/tag/icfpc.html" class="h-link">icfpc</a>                </li>            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">типам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a href="/category/description.html" class="h-link">обращение</a><li>
                <li><a href="/category/friend.html" class="h-link"></a><li>
                <li><a href="/category/join.html" class="h-link"></a><li>
                <li><a href="/category/link.html" class="h-link">ссылки</a><li>
                <li><a href="/category/mood.html" class="h-link">настроение</a><li>
                <li><a href="/category/photo.html" class="h-link">фото</a><li>
                <li><a href="/category/text.html" class="h-link">текст</a><li>
                <li><a href="/category/video.html" class="h-link">видео</a><li>
                <li><a href="/category/wishlist.html" class="h-link"></a><li>
            </ul>
        </div>
    </span>
</div>
    <div class="row b-post">
<div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/30/bukvennoe-pechene/" title="изменено 13 июля 2014 года в 16:45">
                30 сентября 2009 года, 11:49
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/pechene.html">печенье</a></span>,    <span class="tag"><a class="h-link" href="/tag/gotovliu.html">готовлю</a></span>,    <span class="tag"><a class="h-link" href="/tag/eda.html">еда</a></span>,    <span class="tag"><a class="h-link" href="/tag/ovsianoe.html">овсяное</a></span>,    <span class="tag"><a class="h-link" href="/tag/kukhnia.html">кухня</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/09/30/bukvennoe-pechene/">Буквенное печенье</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Вчера вечером сделал овсяное печенье. Приготовилось всё очень
быстро.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/85512/"><img alt="Печенье IMDagger" src="http://img-fotki.yandex.ru/get/3712/imdagger.3/0_14e08_8bf120d1_-1-XL.jpg" style="width: 400px; height: 251px;" title="Печенье IMDagger"/></a></p>
<p>Чем-то я себе напомнил Шелдона Купера из «Теории большого взрыва»,
только я умею хорошо готовить яичницу и несколькими способами ;)… Я
приготовил печенье, затем порпобовал кусочек, пошёл записал заметку в
трофейный блокнот, потом пошёл за фотоаппаратом, сфотографировал
печенье, снова его попробовал, пошёл сделал заметку в трофейную записную
книгу:</p>
<p>Запомнить:</p>
<ol class="arabic simple">
<li>В следующий раз сократить количество маргарина с 300гр до 150гр;</li>
<li>Не использовать бумагу для выпечки и не смазывать её маргарином;</li>
<li>Ложить прямо на противень, после того, как появится слабая корочка
вокруг печенья, то добавить на него кусочек маргарина.</li>
</ol>
<p>Сделал верно:</p>
<ol class="arabic simple">
<li>В моей духовке 150C оптимальная температура, хоть и в рецепте
написано 200C;</li>
<li>Гашеная сода сама приподнимает центр печенья (это видно на
кругленьких).</li>
</ol>
<p>И вообще все мои действия напоминают мне <del class="del">
Шелдона Купера</del>
 кого-то. Я
знал, что я <strong>geek</strong>, но не думал, что я настолько соответствую шуткам
:). Получилось вкусно, но хочу отточить навыки и ещё потренируюсь.</p>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-mood">
    <div class="panel-heading b-post-type b-post-type-mood">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
поделился настроением        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/29/urn:ya.ru:post/22199227/265/" >
                29 сентября 2009 года, 20:01
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <div class="post-title">
            </div>
            <div class="row post-body">
                <div class="b-text">
<p>SOAD “Lonely Day”</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/28/klonirovanie-obrazov/" >
                28 сентября 2009 года, 14:16
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/clonezilla.html">clonezilla</a></span>,    <span class="tag"><a class="h-link" href="/tag/samba4.html">samba4</a></span>,    <span class="tag"><a class="h-link" href="/tag/vosstanovlenie.html">восстановление</a></span>,    <span class="tag"><a class="h-link" href="/tag/boot.html">boot</a></span>,    <span class="tag"><a class="h-link" href="/tag/drbl.html">drbl</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/09/28/klonirovanie-obrazov/">Клонирование образов</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>В моей ситуации PDC сервером является <strong>Samba 4.0.0-alpha9</strong> из GIT.
А клиентские компьютеры под управлением Window$ XP. Был сделан новый
образ с одного компьютера, чтобы поставить его на все остальные
(разметка таже, только операционная система обновлена). Я решил, что
удобнее хранить на сервере одну копию образа и восстанавливать её по
сети, используя PXE для загрузки.</p>
<p>Первая проблема, которая встала передо мной — при попытке
восстановления образа выпадала ошибка, что не удалось клонировать sda2
(но mbr <del class="del">
сволочь</del>
 всё таки Clonezilla заменила). Забавно было, что
разбивка на компьютерах одна и также, но я заметил, что создавал образ с
<strong>sda1</strong>, а пытался восстановить на <strong>sda2</strong> такой же по размеру и
<u class="underline">
начинающийся в тех же секторах</u>
. Тогда я залез в папку с образом (у меня
/home/partimag) и поправил файлы:</p>
<blockquote>
<div class="line-block">
<div class="line">/home/partimag/имя-образа/parts:</div>
<div class="line">было <strong>sda1</strong> стало <strong>sda2</strong></div>
<div class="line">/home/partimag/имя-образа/sda-pt.parted</div>
<div class="line">Поменял номера разделов (поле Number)</div>
<div class="line"><strong>1</strong> &lt;-&gt; <strong>2</strong></div>
<div class="line">/home/partimag/имя-образа/sda-pt.sf</div>
<div class="line">Обменял <strong>sda1</strong> &lt;-&gt; <strong>sda2</strong> (<strong>sda1</strong> - это диск D:)</div>
</div>
</blockquote>
<p>После этих хитрых манипуляций образ поставился, но система наотрез
отказалась запускаться ссылаясь на «повреждённый hal.dll». Снова
поразмыслив, я написал небольшой скрипт и положил его в
<strong>/opt/drbl/share/drbl/postrun</strong>, чтобы после успешного клонирования был
он вызван и исправил в boot.ini на диске строки partition(1) на
partition(<strong>id</strong>), где id — номер раздела, который загрузочный.</p>
<div class="alert  alert-danger compound">
<p><strong>Осторожно!</strong> Если не понятно, что делает этот скрипт, то не при каких
обстоятельствах его не использовать, т.к. он производит слишком
мало проверок на корректность своих действий (и обрабатывает только
sda1, sda2, hda1, hda2 и только ntfs), а также пользуется пакетом
ntfsprogs, который должен быть <strong>обязательно установлен</strong></p>
</div>
<p class="cut"><a class="h-link reference internal" href="#cut_58705808"data-toggle="collapse">хочу узреть программу!</a></p>
<div class="collapse" id="cut_58705808">
<div class="highlight"><pre><span class="pgcss-c">#! /bin/sh</span>
<span class="pgcss-k">for </span>id in 1 2; <span class="pgcss-k">do</span>
<span class="pgcss-k">   for </span>hdd in hda sda; <span class="pgcss-k">do</span>
<span class="pgcss-k">      </span><span class="pgcss-nv">disk</span><span class="pgcss-o">=</span><span class="pgcss-nv">$hdd$id</span>
      <span class="pgcss-nb">echo</span> <span class="pgcss-s2">&quot;Trying $disk ...&quot;</span>

      <span class="pgcss-k">if</span> <span class="pgcss-o">[</span> ! -z <span class="pgcss-sb">`</span>ntfsls -f /dev/<span class="pgcss-nv">$disk</span> <span class="pgcss-se">\|</span> grep boot.ini<span class="pgcss-sb">`</span> <span class="pgcss-o">]</span>; <span class="pgcss-k">then</span>
<span class="pgcss-k">         </span><span class="pgcss-nb">echo</span> <span class="pgcss-s2">&quot;Found primary boot disk ...&quot;</span>
         ntfscat -f /dev/<span class="pgcss-nv">$disk</span> boot.ini &gt;/root/boot.ini
         <span class="pgcss-k">if</span> <span class="pgcss-o">[</span> -z <span class="pgcss-sb">`</span>cat /root/boot.ini<span class="pgcss-sb">`</span> <span class="pgcss-o">]</span>; <span class="pgcss-k">then</span>
<span class="pgcss-k">            </span><span class="pgcss-nb">echo</span> <span class="pgcss-s2">&quot;Error!&quot;</span>
            <span class="pgcss-nb">exit </span>1;
         <span class="pgcss-k">fi</span>

<span class="pgcss-k">         </span><span class="pgcss-nb">echo</span> <span class="pgcss-s2">&quot;Try to fix disk ...&quot;</span>
         ntfsfix /dev/<span class="pgcss-nv">$disk</span>
         sed <span class="pgcss-s2">&quot;s/\(.*\)partition([01234]\?)\(.*\)/\1partition($id)\2/&quot;</span> /root/boot.ini &gt;/root/boot_new.ini
         <span class="pgcss-nb">echo</span> <span class="pgcss-s2">&quot;Replace boot.ini by new&quot;</span>
         ntfscp -f /dev/<span class="pgcss-nv">$disk</span> /root/boot_new.ini boot.ini
      <span class="pgcss-k">else</span>
<span class="pgcss-k">         </span><span class="pgcss-nb">echo</span> <span class="pgcss-s2">&quot;Not found boot.ini&quot;</span>
      <span class="pgcss-k">fi</span>
<span class="pgcss-k">   done</span>
<span class="pgcss-k">done</span>
</pre></div>
</div>
<p>Вуаля и о чудо, винда загрузилась… Но… при попытке ввести в домен
выпала ошибка «Именам пользователей не сопоставлены коды защиты данных».
Я заглянул на сервер в LDAP-директорию и обнаружил компьютер 2-5-9 с
CN=2-5-0, а именем 2-5-9. Ясно, что из-за одинакового имени всех
компьютеров из образа — 2-5-0 (можно было раздавать имена средствами
Clonezilla, там есть даже галочка для этого, но мне было лень делать
список MAC-адресов). Тогда, чтобы эта ошибка не выпадала, я:</p>
<ol class="arabic simple">
<li>Удалил запись 2-5-0 из LDAP от Samba4;</li>
<li>Переименовывал машины без ввода в домен и с перезагрузкой;</li>
<li>Только после перезагрузки вводил в домен.</li>
<li>И вот всё заработало как надо.</li>
</ol>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/28/mozg/" >
                28 сентября 2009 года, 06:38
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/rabota.html">работа</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/09/28/mozg/">Мозг</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Мозг проснулся в 5:20 и сказал: «Бе-бе-бе хочу спать! Спать!». Но я
решил, что он и так достаточно поспал 5 часов, и пора работать. Солнце
ещё не поднялось, а я уже на работе :(. Нужно починить машинки, чтобы
они в 8:20 уже работали…</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-link">
    <div class="panel-heading b-post-type b-post-type-link">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
поделился ссылкой        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/27/avtomaticheskoe-testirovanie/" >
                27 сентября 2009 года, 19:41
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/java.html">java</a></span>,    <span class="tag"><a class="h-link" href="/tag/testirovanie.html">тестирование</a></span></div>
            <div class="post-title">
<a class="h-link" href="http://sourceforge.net/projects/jwebunit/">
    <img class="b-ico" src="http://favicon.yandex.ru/favicon/sourceforge.net?default=yaru-external">Автоматическое тестирование</a>
            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Для автотестирования Web-приложений из Java-кода.
А ещё там есть ссылка на Selenium.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-mood">
    <div class="panel-heading b-post-type b-post-type-mood">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
поделился настроением        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/26/urn:ya.ru:post/22199227/257/" >
                26 сентября 2009 года, 18:28
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <div class="post-title">
            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Душа растерзана, мозг потоптан, эх…</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/26/kak-ia-pokorial-tablichnye-funktsii/" >
                26 сентября 2009 года, 17:35
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/spring.html">spring</a></span>,    <span class="tag"><a class="h-link" href="/tag/hibernate.html">hibernate</a></span>,    <span class="tag"><a class="h-link" href="/tag/annotatsii.html">аннотации</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/09/26/kak-ia-pokorial-tablichnye-funktsii/">Как я покорял табличные функции</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Во-первых, я хотел постараться проделать всю работу через аннотации
<strong>JPA</strong> и <strong>Hibernate</strong>. Но мне требовалось промэппить пробный класс
<em>HeaderItem</em> не только на таблицу <em>dl2ResultsHeaderItem</em>, но и на
результат функции из базы данных. А функция
<em>dl2ResultsHeaderItemSubTree</em> требует 5 параметров и возвращает таблицу
из 3 параметров, у которой не все названия совпадают с
dl2ResultsHeaderItem.</p>
<p>Поискав во «всемирной паутине» ответ на свой вопрос, как сделать
такую операцию, я нашёл ответ только для хранимых процедур, а мне нужна
была хранимая функция. Причём всё, что я находил похожее для моих нужд,
оно почему-то у меня не работало.</p>
<p>Поэтому я нашёл способ реализовать задуманное через аннотацию
NamedNativeQuery из javax.persistence, я его переделал из примера для
хранимых процедур:</p>
<p class="cut"><a class="h-link reference internal" href="#cut_62087952"data-toggle="collapse">и как оно выглядит?</a></p>
<div class="collapse" id="cut_62087952">
<div class="highlight"><pre><span class="pgcss-kn">package</span> <span class="pgcss-n">results</span><span class="pgcss-o">;</span>
<span class="pgcss-kn">import</span> <span class="pgcss-nn">java.io.Serializable</span><span class="pgcss-o">;</span>
<span class="pgcss-kn">import</span> <span class="pgcss-nn">javax.persistence.*</span><span class="pgcss-o">;</span>
<span class="pgcss-nd">@Entity</span>
<span class="pgcss-nd">@NamedNativeQuery</span> <span class="pgcss-o">(</span><span class="pgcss-n">name</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&quot;headerItem.forSubTree&quot;</span><span class="pgcss-o">,</span>
        <span class="pgcss-n">resultClass</span> <span class="pgcss-o">=</span> <span class="pgcss-n">HeaderItem</span><span class="pgcss-o">.</span><span class="pgcss-na">class</span><span class="pgcss-o">,</span>
        <span class="pgcss-n">query</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&quot;select itemId, itemIndex as childIndex, deep from dl2ResultsHeaderItemSubTree</span>
<span class="pgcss-s">                  (:rootId, :deep, :leavesOnly, :includeRoot, :date)&quot;</span><span class="pgcss-o">,</span>
        <span class="pgcss-n">hints</span> <span class="pgcss-o">=</span> <span class="pgcss-o">{</span><span class="pgcss-nd">@QueryHint</span> <span class="pgcss-o">(</span><span class="pgcss-n">name</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&quot;org.hibernate.callable&quot;</span><span class="pgcss-o">,</span> <span class="pgcss-n">value</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&quot;true&quot;</span><span class="pgcss-o">),</span> <span class="pgcss-o">*</span><span class="pgcss-c1">// Бага!!!*</span>
                 <span class="pgcss-nd">@QueryHint</span> <span class="pgcss-o">(</span><span class="pgcss-n">name</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&quot;org.hibernate.readOnly&quot;</span><span class="pgcss-o">,</span> <span class="pgcss-n">value</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&quot;true&quot;</span><span class="pgcss-o">)</span>
        <span class="pgcss-o">}</span>
<span class="pgcss-o">)</span>
<span class="pgcss-nd">@Table</span> <span class="pgcss-o">(</span><span class="pgcss-n">name</span><span class="pgcss-o">=</span><span class="pgcss-s">&quot;dl2ResultsHeaderItem&quot;</span><span class="pgcss-o">)</span>
<span class="pgcss-kd">public</span> <span class="pgcss-kd">class</span> <span class="pgcss-nc">HeaderItem</span> <span class="pgcss-kd">implements</span> <span class="pgcss-n">Serializable</span> <span class="pgcss-o">{</span>
    <span class="pgcss-kd">private</span> <span class="pgcss-n">Long</span> <span class="pgcss-n">id</span><span class="pgcss-o">;</span>
    <span class="pgcss-kd">private</span> <span class="pgcss-n">Long</span> <span class="pgcss-n">index</span><span class="pgcss-o">;</span>
    <span class="pgcss-kd">private</span> <span class="pgcss-kt">int</span> <span class="pgcss-n">deep</span><span class="pgcss-o">;</span>

    <span class="pgcss-kd">public</span> <span class="pgcss-nf">HeaderItem</span><span class="pgcss-o">()</span> <span class="pgcss-o">{</span>
    <span class="pgcss-o">};</span>

    <span class="pgcss-nd">@Id</span>
    <span class="pgcss-nd">@Column</span><span class="pgcss-o">(</span><span class="pgcss-n">name</span><span class="pgcss-o">=</span><span class="pgcss-s">&quot;itemId&quot;</span><span class="pgcss-o">)</span>
    <span class="pgcss-kd">public</span> <span class="pgcss-n">Long</span> <span class="pgcss-nf">getId</span><span class="pgcss-o">()</span> <span class="pgcss-o">{</span>
        <span class="pgcss-k">return</span> <span class="pgcss-n">id</span><span class="pgcss-o">;</span>
    <span class="pgcss-o">};</span>

    <span class="pgcss-kd">public</span> <span class="pgcss-kt">void</span> <span class="pgcss-nf">setId</span><span class="pgcss-o">(</span><span class="pgcss-n">Long</span> <span class="pgcss-n">id</span><span class="pgcss-o">)</span> <span class="pgcss-o">{</span>
        <span class="pgcss-k">this</span><span class="pgcss-o">.</span><span class="pgcss-na">id</span> <span class="pgcss-o">=</span> <span class="pgcss-n">id</span><span class="pgcss-o">;</span>
    <span class="pgcss-o">};</span>

    <span class="pgcss-nd">@Column</span><span class="pgcss-o">(</span><span class="pgcss-n">name</span><span class="pgcss-o">=</span><span class="pgcss-s">&quot;childIndex&quot;</span><span class="pgcss-o">)</span>
    <span class="pgcss-kd">public</span> <span class="pgcss-n">Long</span> <span class="pgcss-nf">getIndex</span><span class="pgcss-o">()</span> <span class="pgcss-o">{</span>
        <span class="pgcss-k">return</span> <span class="pgcss-n">index</span><span class="pgcss-o">;</span>
    <span class="pgcss-o">};</span>

    <span class="pgcss-kd">public</span> <span class="pgcss-kt">void</span> <span class="pgcss-nf">setIndex</span><span class="pgcss-o">(</span><span class="pgcss-n">Long</span> <span class="pgcss-n">index</span><span class="pgcss-o">)</span> <span class="pgcss-o">{</span>
        <span class="pgcss-k">this</span><span class="pgcss-o">.</span><span class="pgcss-na">index</span> <span class="pgcss-o">=</span> <span class="pgcss-n">index</span><span class="pgcss-o">;</span>
    <span class="pgcss-o">};</span>

    <span class="pgcss-nd">@Column</span><span class="pgcss-o">(</span><span class="pgcss-n">name</span><span class="pgcss-o">=</span><span class="pgcss-s">&quot;deep&quot;</span><span class="pgcss-o">)</span>
    <span class="pgcss-kd">public</span> <span class="pgcss-kt">int</span> <span class="pgcss-nf">getDeep</span><span class="pgcss-o">()</span> <span class="pgcss-o">{</span>
        <span class="pgcss-k">return</span> <span class="pgcss-n">deep</span><span class="pgcss-o">;</span>
    <span class="pgcss-o">};</span>

    <span class="pgcss-kd">public</span> <span class="pgcss-kt">void</span> <span class="pgcss-nf">setDeep</span><span class="pgcss-o">(</span><span class="pgcss-kt">int</span> <span class="pgcss-n">id</span><span class="pgcss-o">)</span> <span class="pgcss-o">{</span>
        <span class="pgcss-k">this</span><span class="pgcss-o">.</span><span class="pgcss-na">deep</span> <span class="pgcss-o">=</span> <span class="pgcss-n">deep</span><span class="pgcss-o">;</span>
    <span class="pgcss-o">};</span>
<span class="pgcss-o">};</span>
</pre></div>
<p>Запрос <em>select itemId, itemIndex as childIndex, deep ...</em> выбирает
данные таким образом, чтобы поля возвращаемой таблицы совпадали с
указанным в классе мэппингом.</p>
<p>Жаль, но таблицу и хранимую функцию делал не я, а за долго до
меня. Поэтому их ломать нельзя (слишком много эксплуатируемого кода на
них висит). Я довольно долго боролся с Hibernate, т.к. выпадало
исколючение в jTDS вида: <code class="code">
11410 [http-8080-1] INFO
org.hibernate.type.CalendarType - could not bind value ‘2009-09-26
16:30:13’ to parameter: 5; Invalid parameter index 5</code>
. Я долго думал, как
так может быть, что параметров вроде 5, передаю 5 такой конструкцией
(<del class="del">
собранной на скорую руку</del>
):</p>
<div class="highlight"><pre><span class="pgcss-n">List</span> <span class="pgcss-n">result</span> <span class="pgcss-o">=</span>
<span class="pgcss-n">getHibernateTemplate</span><span class="pgcss-o">().</span><span class="pgcss-na">findByNamedQueryAndNamedParam</span><span class="pgcss-o">(</span><span class="pgcss-s">&quot;headerItem.forSubTree&quot;</span><span class="pgcss-o">,</span>
    <span class="pgcss-k">new</span> <span class="pgcss-n">String</span><span class="pgcss-o">[]</span> <span class="pgcss-o">{</span><span class="pgcss-s">&quot;rootId&quot;</span><span class="pgcss-o">,</span> <span class="pgcss-s">&quot;deep&quot;</span><span class="pgcss-o">,</span> <span class="pgcss-s">&quot;leavesOnly&quot;</span><span class="pgcss-o">,</span> <span class="pgcss-s">&quot;includeRoot&quot;</span><span class="pgcss-o">,</span> <span class="pgcss-s">&quot;date&quot;</span><span class="pgcss-o">},</span>
    <span class="pgcss-k">new</span> <span class="pgcss-n">Object</span><span class="pgcss-o">[]</span> <span class="pgcss-o">{</span><span class="pgcss-n">rootId</span><span class="pgcss-o">,</span> <span class="pgcss-n">deep</span><span class="pgcss-o">,</span> <span class="pgcss-n">leavesOnly</span><span class="pgcss-o">,</span> <span class="pgcss-o">(</span><span class="pgcss-n">includeRoot</span> <span class="pgcss-o">?</span> <span class="pgcss-mi">1</span> <span class="pgcss-o">:</span> <span class="pgcss-mi">0</span><span class="pgcss-o">),</span> <span class="pgcss-n">date</span><span class="pgcss-o">});</span> <span class="pgcss-c1">// date типа java.util.Calendar</span>
</pre></div>
<p>Но потом до меня дошло, что мешает <code class="code">
&#64;QueryHint(name =
&quot;org.hibernate.callable&quot;, value = &quot;true&quot;)</code>
, который предполагает, что это
процедура и первый параметр забирает под её нужды.</p>
<p>Проблема решилась банально — я убрал эту запись и всё заработало.</p>
</div>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-photo">
    <div class="panel-heading b-post-type b-post-type-photo">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
вывесил фотки        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/24/pust-zemlia-budet-pukhom/" >
                24 сентября 2009 года, 14:52
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/pozhar.html">пожар</a></span>,    <span class="tag"><a class="h-link" href="/tag/vinchester.html">винчестер</a></span></div>
            <div class="post-title">
<a class="no-link" href="posts/2009/09/24/pust-zemlia-budet-pukhom/">Пусть земля будет пухом</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p class="row photo-item"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/83761"><img alt="Пусть земля будет пухом" src="http://img-fotki.yandex.ru/get/3804/imdagger.3/0_14731_11fe5928_L" title="Пусть земля будет пухом"/></a></p>
<p class="row photo-item"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/83762"><img alt="Пусть земля будет пухом" src="http://img-fotki.yandex.ru/get/3806/imdagger.3/0_14732_ac9656b_L" title="Пусть земля будет пухом"/></a></p>
<p class="row photo-item"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/83763"><img alt="Пусть земля будет пухом" src="http://img-fotki.yandex.ru/get/3714/imdagger.3/0_14733_ed6c586a_L" title="Пусть земля будет пухом"/></a></p>
<p class="row photo-item"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/83764"><img alt="Пусть земля будет пухом" src="http://img-fotki.yandex.ru/get/3709/imdagger.3/0_14734_8f97da7e_L" title="Пусть земля будет пухом"/></a></p>
<p>Покойся с миром славный сын из рода Samsung, пусть земля будет тебе
пухом. Твои 80Gb принесли много радости и счастья, тебя и твоих битов
нам ничто не заменит…</p>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-mood">
    <div class="panel-heading b-post-type b-post-type-mood">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
поделился настроением        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/23/urn:ya.ru:post/22199227/252/" >
                23 сентября 2009 года, 17:45
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <div class="post-title">
            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Появилась небольшая апатия, хотя я знаю почему :)</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/09/23/steny-kreposti-postroeny/" >
                23 сентября 2009 года, 17:20
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/dl.html">dl</a></span>,    <span class="tag"><a class="h-link" href="/tag/java.html">java</a></span>,    <span class="tag"><a class="h-link" href="/tag/spring.html">spring</a></span>,    <span class="tag"><a class="h-link" href="/tag/hibernate.html">hibernate</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/09/23/steny-kreposti-postroeny/">Стены крепости построены</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Прочитав
<a class="reference external" href="http://samolisov.blogspot.com/2009/06/hibernate-spring.html">блог</a>
сурового челябинского программиста и
<a class="reference external" href="http://maestric.com/doc/java/spring/mvc">туториал</a>, как работать со
<strong>SpringFramework</strong>, я всё же смог настроить тандем Spring+Hibernate.
Т.к. я сначала настраивал <strong>Hibernate</strong> отдельно, а затем прикручивал
Spring, то вышло, что часть настроек из конфигов нужно было перенести в
другое место из-за того, что в связке настройку будет производить
фреймворк, а не ORM. Пришлось убрать файл context.xml из META-INF,
который описывал параметры подключения Hibernate3 к базе данных через
драйвер <strong>jTDS</strong>. Настройки web.xml в WEB-INF стали выглядеть таким
образом:</p>
<p class="cut"><a class="h-link reference internal" href="#cut_57276816"data-toggle="collapse">а как?</a></p>
<div class="collapse" id="cut_57276816">
<div class="highlight"><pre>...
<span class="pgcss-nt">&lt;web-app</span> <span class="pgcss-na">xmlns=</span><span class="pgcss-s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
  <span class="pgcss-na">xmlns:xsi=</span><span class="pgcss-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="pgcss-na">xsi:schemaLocation=</span><span class="pgcss-s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span>
  <span class="pgcss-na">version=</span><span class="pgcss-s">&quot;2.5&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;servlet&gt;</span>
  <span class="pgcss-nt">&lt;servlet-name&gt;</span>dl<span class="pgcss-nt">&lt;/servlet-name&gt;</span>
  <span class="pgcss-nt">&lt;servlet-class&gt;</span>
      <strong>org.springframework.web.servlet.DispatcherServlet</strong>
  <span class="pgcss-nt">&lt;/servlet-class&gt;</span>
  <span class="pgcss-nt">&lt;load-on-startup&gt;</span>1<span class="pgcss-nt">&lt;/load-on-startup&gt;</span>
  <span class="pgcss-nt">&lt;/servlet&gt;</span>
  <span class="pgcss-nt">&lt;servlet-mapping&gt;</span>
  <span class="pgcss-nt">&lt;servlet-name&gt;</span>dl<span class="pgcss-nt">&lt;/servlet-name&gt;</span>
  <strong><span class="pgcss-nt">&lt;url-pattern&gt;</span>/<span class="pgcss-nt">&lt;/url-pattern&gt;</span></strong>
  <span class="pgcss-nt">&lt;/servlet-mapping&gt;</span>
  <span class="pgcss-nt">&lt;context-param&gt;</span>
  <span class="pgcss-nt">&lt;param-name&gt;</span>contextConfigLocation<span class="pgcss-nt">&lt;/param-name&gt;</span>
  <strong><span class="pgcss-nt">&lt;param-value&gt;</span>/WEB-INF/dl-servlet.xml<span class="pgcss-nt">&lt;/param-value&gt;</span></strong>
  <span class="pgcss-nt">&lt;/context-param&gt;</span>
  <span class="pgcss-nt">&lt;listener&gt;</span>
  <span class="pgcss-nt">&lt;listener-class&gt;</span>
      <strong>org.springframework.web.context.ContextLoaderListener</strong>
  <span class="pgcss-nt">&lt;/listener-class&gt;</span>
  <span class="pgcss-nt">&lt;/listener&gt;</span>
<strong>...</strong>
<span class="pgcss-nt">&lt;/web-app&gt;</span>
</pre></div>
<p>Тег servlet указывает Apache Tomcat, что нужно загрузить сервлет
<strong>org.springframework.web.servlet.DispatcherServlet</strong> для обработки
запросов. В директории WEB-INFнаходится файл dl-servlet.xml, который
описывает настройки сервлета:</p>
<div class="highlight"><pre><span class="pgcss-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="pgcss-nt">&lt;beans</span> <span class="pgcss-na">xmlns=</span><span class="pgcss-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
  <span class="pgcss-na">xmlns:xsi=</span><span class="pgcss-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="pgcss-na">xmlns:aop=</span><span class="pgcss-s">&quot;http://www.springframework.org/schema/aop&quot;</span>
  <span class="pgcss-na">xsi:schemaLocation=</span><span class="pgcss-s">&quot;http://www.springframework.org/schema/beans</span>
<span class="pgcss-s">  http://www.springframework.org/schema/beans/spring-beans-2.0.xsd&quot;</span><span class="pgcss-nt">&gt;</span>
  <strong><span class="pgcss-nt">&lt;import</span> <span class="pgcss-na">resource=</span><span class="pgcss-s">&quot;/dl-context/main-context.xml&quot;</span> <span class="pgcss-nt">/&gt;</span></strong>
<span class="pgcss-nt">&lt;/beans&gt;</span>
</pre></div>
<p>Он подключает из каталога dl-context различные параметры настройки. Пока
у меня всего один файл, но скоро я разобью опции на несколько файлов по
типам. Настройка основного контекста описана в main-context.xml:</p>
<div class="highlight"><pre><span class="pgcss-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="pgcss-nt">&lt;beans</span> <span class="pgcss-na">xmlns=</span><span class="pgcss-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
  <span class="pgcss-na">xmlns:xsi=</span><span class="pgcss-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="pgcss-na">xmlns:aop=</span><span class="pgcss-s">&quot;http://www.springframework.org/schema/aop&quot;</span>
  <span class="pgcss-na">xsi:schemaLocation=</span><span class="pgcss-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd&quot;</span><span class="pgcss-nt">&gt;</span>
<span class="pgcss-c">&lt;!-- This config contains main info about application mappings and view resolvers--&gt;</span>
<span class="pgcss-nt">&lt;bean</span> <span class="pgcss-na">id=</span><span class="pgcss-s">&quot;dataSource&quot;</span> <span class="pgcss-na">class=</span><span class="pgcss-s">&quot;<strong>org.apache.tomcat.dbcp.dbcp.BasicDataSource</strong>&quot;</span> <span class="pgcss-na">destroy-method=</span><span class="pgcss-s">&quot;close&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;driverClassName&quot;</span> <span class="pgcss-na">value=</span><span class="pgcss-s">&quot;<strong>net.sourceforge.jtds.jdbc.Driver</strong>&quot;</span> <span class="pgcss-nt">/&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;url&quot;</span> <span class="pgcss-na">value=</span><span class="pgcss-s">&quot;<strong>jdbc:jtds:sqlserver://dl-test:1030/dldb</strong>&quot;</span> <span class="pgcss-nt">/&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;username&quot;</span> <span class="pgcss-na">value=</span><span class="pgcss-s">&quot;<strong>пользователь-базы</strong>&quot;</span> <span class="pgcss-nt">/&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;password&quot;</span> <span class="pgcss-na">value=</span><span class="pgcss-s">&quot;<strong>пароль</strong>&quot;</span> <span class="pgcss-nt">/&gt;</span>
<span class="pgcss-nt">&lt;/bean&gt;</span>
<span class="pgcss-nt">&lt;bean</span> <span class="pgcss-na">id=</span><span class="pgcss-s">&quot;sessionFactory&quot;</span> <span class="pgcss-na">class=</span><span class="pgcss-s">&quot;org.springframework.orm.hibernate3.LocalSessionFactoryBean&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;dataSource&quot;</span> <span class="pgcss-na">ref=</span><span class="pgcss-s">&quot;dataSource&quot;</span> <span class="pgcss-nt">/&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;configLocation&quot;</span> <span class="pgcss-na">value=</span><span class="pgcss-s">&quot;classpath:/hibernate.cfg.xml&quot;</span> <span class="pgcss-nt">/&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;configurationClass&quot;</span> <span class="pgcss-na">value=</span><span class="pgcss-s">&quot;org.hibernate.cfg.AnnotationConfiguration&quot;</span> <span class="pgcss-nt">/&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;hibernateProperties&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;props&gt;</span>
  <span class="pgcss-nt">&lt;prop</span> <span class="pgcss-na">key=</span><span class="pgcss-s">&quot;hibernate.dialect&quot;</span><span class="pgcss-nt">&gt;</span>${hibernate.dialect}<span class="pgcss-nt">&lt;/prop&gt;</span>
  <span class="pgcss-nt">&lt;/props&gt;</span>
  <span class="pgcss-nt">&lt;/property&gt;</span>
<span class="pgcss-nt">&lt;/bean&gt;</span>
<strong><span class="pgcss-nt">&lt;bean</span> <span class="pgcss-na">id=</span><span class="pgcss-s">&quot;cellDAO&quot;</span> <span class="pgcss-na">class=</span><span class="pgcss-s">&quot;results.CellDao&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;sessionFactory&quot;</span> <span class="pgcss-na">ref=</span><span class="pgcss-s">&quot;sessionFactory&quot;</span> <span class="pgcss-nt">/&gt;</span>
<span class="pgcss-nt">&lt;/bean&gt;</span>
<span class="pgcss-nt">&lt;bean</span> <span class="pgcss-na">id=</span><span class="pgcss-s">&quot;cellService&quot;</span> <span class="pgcss-na">class=</span><span class="pgcss-s">&quot;results.CellService&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;dao&quot;</span> <span class="pgcss-na">ref=</span><span class="pgcss-s">&quot;cellDAO&quot;</span> <span class="pgcss-nt">/&gt;</span>
<span class="pgcss-nt">&lt;/bean&gt;</span>
<span class="pgcss-nt">&lt;bean</span> <span class="pgcss-na">id=</span><span class="pgcss-s">&quot;resultsTableController&quot;</span> <span class="pgcss-na">class=</span><span class="pgcss-s">&quot;results.TableController&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;cellService&quot;</span> <span class="pgcss-na">ref=</span><span class="pgcss-s">&quot;cellService&quot;</span><span class="pgcss-nt">/&gt;</span>
<span class="pgcss-nt">&lt;/bean&gt;</span></strong>
<span class="pgcss-nt">&lt;bean</span> <span class="pgcss-na">id=</span><span class="pgcss-s">&quot;simpleUrlHandler&quot;</span> <span class="pgcss-na">class=</span><span class="pgcss-s">&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;order&quot;</span><span class="pgcss-nt">&gt;&lt;value&gt;</span>0<span class="pgcss-nt">&lt;/value&gt;&lt;/property&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;mappings&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;props&gt;</span>
  <strong><span class="pgcss-nt">&lt;prop</span> <span class="pgcss-na">key=</span><span class="pgcss-s">&quot;results&quot;</span><span class="pgcss-nt">&gt;</span>resultsTableController<span class="pgcss-nt">&lt;/prop&gt;</span></strong>
  <span class="pgcss-nt">&lt;/props&gt;</span>
  <span class="pgcss-nt">&lt;/property&gt;</span>
<span class="pgcss-nt">&lt;/bean&gt;</span>
<span class="pgcss-nt">&lt;bean</span> <span class="pgcss-na">id=</span><span class="pgcss-s">&quot;viewResolver&quot;</span> <span class="pgcss-na">class=</span><span class="pgcss-s">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="pgcss-nt">&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;cache&quot;</span> <span class="pgcss-na">value=</span><span class="pgcss-s">&quot;false&quot;</span><span class="pgcss-nt">/&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;viewClass&quot;</span><span class="pgcss-nt">&gt;&lt;value&gt;</span>org.springframework.web.servlet.view.JstlView<span class="pgcss-nt">&lt;/value&gt;&lt;/property&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;prefix&quot;</span><span class="pgcss-nt">&gt;&lt;value&gt;</span>/WEB-INF/pages/jsp/<span class="pgcss-nt">&lt;/value&gt;&lt;/property&gt;</span>
  <span class="pgcss-nt">&lt;property</span> <span class="pgcss-na">name=</span><span class="pgcss-s">&quot;suffix&quot;</span><span class="pgcss-nt">&gt;&lt;value&gt;</span>.jsp<span class="pgcss-nt">&lt;/value&gt;&lt;/property&gt;</span>
<span class="pgcss-nt">&lt;/bean&gt;</span>
<span class="pgcss-nt">&lt;/beans&gt;</span>
</pre></div>
<p>Сервер баз данных у меня внешний MSSQL 2005 Express Edition (к
сожалению у меня нету выбора и приходится работать с этим, т.к. я лишь
рефакторю код существующей большой системы, которую просто так нельзя
сломать). Запускаю же Tomcat у себя на Linux.</p>
<p>В бине (не путать с бинами из Java, это другое понятие бина, оно из
Spring) <strong>dataSource</strong> указываются параметры подключения к серверу БД и
класс драйвера JDBC. В sessionFactory указано, что при создании объекта
из этого бина, нужно создать объект dataSource, для этого написана
ссылка &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;.</p>
<p>CellDao, CellService и ResultsTableController — это мои пробные
классы для работы с ячейками таблицы результатов. Маппинг &lt;prop
key=&quot;results&quot;&gt;resultsTableController&lt;/prop&gt; позволяет, при переходе по
адресу <strong>http://localhost:8080/dl/results</strong>, передавать управление
контроллеру ResultsTableController, котрый в свою очередь создаёт
представление:</p>
<div class="highlight"><pre><span class="pgcss-o">...</span>
<span class="pgcss-o">...</span> <span class="pgcss-k">new</span> <span class="pgcss-n">ModelAndView</span><span class="pgcss-o">(</span><span class="pgcss-s">&quot;<strong>index</strong>&quot;</span><span class="pgcss-o">)</span>
<span class="pgcss-o">...</span>
</pre></div>
<p>Я сделал это, чтобы проверить мэппинг. Сами JSP-файлы (в частности и
index.jsp) хранятся в WEB-INF/pages/jsp/, эта информация настривается в
бине <strong>viewResolver</strong>. В скором будущем я добавлю класс XsltViewer,
который будет использовать не JSP, а XSLT.Это связано с потребностью в
отображении HTML-данных и XML API-интерфейсе одновременно, но при
отсутствии дублирования кода.</p>
</div>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div>        <div class="panel panel-default">
            <div class="panel-body more">
                <span class="less-prev"><a class="h-link" href="author/imdagger95.html">Назад</a></span>
                <span class="more-next"><a class="h-link" href="author/imdagger97.html">Ещё записи</a></span>
            </div>
        </div>
    </div>
</div>
        </div>
<!-- Yandex.Metrika informer --><a href="https://metrika.yandex.ru/stat/?id=25746494&amp;from=informer" target="_blank" rel="nofollow"><img src="//bs.yandex.ru/informer/25746494/3_1_FFFFFFFF_EFEFEFFF_0_pageviews" style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" onclick="try{Ya.Metrika.informer({i:this,id:25746494,lang:'ru'});return false}catch(e){}"/></a><!-- /Yandex.Metrika informer --><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter25746494 = new Ya.Metrika({id:25746494, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/25746494" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->    </body>
</html>