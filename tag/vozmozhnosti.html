<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <title>IMDagger: Дневник</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Блог IMDagger: IT и жизнь" />
        <meta name="keywords" content="python,lisp,scheme,racket,emacs,blender,программирование,моделирование,lua,c++,c,js,java,git,bazaar" />
        <meta name="author" content="Alex Moiseenko (IMDagger)" />

<meta name="robots" content="noindex"/>
        <!-- Open Graph -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="stylesheet" href="/theme/css/html4css1.css" />
        <link rel="stylesheet" href="/theme/css/style.css" />
        <link rel="stylesheet" href="/theme/css/pygment.css" />
        <link rel="stylesheet" href="/theme/css/math.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://imdagger.github.io/theme/js/math.js"></script>
        <script src="http://s3.amazonaws.com/nwapi/nwmatcher/nwmatcher-1.2.5-min.js"></script>
        <!--[if (gte IE 6)&(lte IE 8)]>
          <script type="text/javascript" src="/theme/js/selectivizr-min.js"></script>
          <noscript><link rel="stylesheet" href="[fallback css]" /></noscript>
        <![endif]-->

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="row page-head">
            <div class="row page-head-status page-head-status-top"><div class="col-sm-12 b-status mine"><p><i></i><a href="#" title="настроение" class="b-consistent-link"><b>Продать кому-то что-то всегда на деле сложнее, чем кажется</b></a></p></div></div>
            <div class="col-sm-2 page-left">
                <a href="#">
                    <img src="http://upics.yandex.ru/22199227/normal" ilo-full-src="http://upics.yandex.ru/22199227/normal">
                </a>
            </div>
            <div class="col-sm-10 all-posts">
                <div class="title-container">
                    <h1><b><a href="http://imdagger.github.io" class="fn nickname">IMDagger</a></b></h1>
                </div>
                <div class="title-menu">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="active">
                            <a href="#">Дневник</a>
                        </li>
                        <li><a href="#">О себе</a></li>
                        <li><a href="#">Фотки</a></li>
                        <li><a href="#">RSS-ленты</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row page-body">
<div class="col-sm-2 page-left">
<div class="row widget widget-photo">
    <a href="posts/2011/08/07/aga-popalsia/" class="b-user-photo__link"><img class="b-user-photo__img" src=" http://img-fotki.yandex.ru/get/5409/22199227.a/0_625fc_e780ccc7_L
?log_nocount=64720402854"></a>
</div><div class="row widget">
    <div class="widget-content b-user-info">
        <div class="widget__body">
            <div class="widget-user-info__age">
                <i class="widget-user-info__sex widget-user-info__sex_type_"></i> 26&nbsp;лет
            </div>
            <div class="widget-user-info__place">
                <a href="#">Гомель</a>,                <a href="#">Беларусь</a>            </div>
            <ul class="contacts">
                <li class="contact contact-type-email"><i></i><a href="mailto:imdagger@yandex.ru">imdagger@yandex.ru</a></li>
                <li class="contact contact-type-ya-online"><i></i>imdagger@ya.ru</li>
                <li class="contact contact-type-icq"><i></i>350395088</li>
            </ul>
        </div>
    </div>
</div>

<div class="row widget">
    <div class="widget-content">
        <div class="widget__title">
            <div class="widget__title-link">Метрика</div>
        </div>
        <div class="widget__body">
            <div class="widget-line">
              <!-- noindex -->
              <!-- googleoff: index -->
              <div class="widget-entry">
                <!-- Yandex.Metrika informer --><a href="https://metrika.yandex.ru/stat/?id=25746494&amp;from=informer" target="_blank" rel="nofollow"><img src="//bs.yandex.ru/informer/25746494/3_1_FFFFFFFF_EFEFEFFF_0_pageviews" style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" onclick="try{Ya.Metrika.informer({i:this,id:25746494,lang:'ru'});return false}catch(e){}"/></a><!-- /Yandex.Metrika informer --><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter25746494 = new Ya.Metrika({id:25746494, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/25746494" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->
                <!-- googleon: index -->
                <!-- /noindex -->
                </div>
            </div>
        </div>
    </div>
</div><div class="row widget">
    <div class="widget-content">
        <div class="widget__title">
            <div class="widget__title-link">Популярное в дневнике</div>
        </div>
        <div class="widget__body">
            <div class="widget-line">
                <div class="widget-entry">
                    <div class="widget-day__title">25&nbsp;июня</div>
                    <div class="widget-entry clearfix">
                        <div class="widget-entry__item">
                            <div class="widget-entry__title">
                                <a href="#" class="h-link">&nbsp;&nbsp;&nbsp; Висцеральная теория сна выглядит стр…</a>
                            </div>
                            <div class="widget-entry__info">2&nbsp;ответа</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div></div>

<div class="col-sm-10 all-posts">
<div class="row b-post-filter">
    <span class="pull-right">
        записи по
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">месяцам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a rel="nofollow" href="#" class="h-link">Нулябрь</a><li>
                <li><a rel="nofollow" href="#" class="h-link">Первябрь</a><li>
            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">меткам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">                <li>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/emacs.html" class="h-link">emacs</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/java.html" class="h-link">java</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/rabota.html" class="h-link">работа</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/sborka.html" class="h-link">сборка</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/programmirovanie.html" class="h-link">программирование</a>                </li>                <li>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/icfpc.html" class="h-link">icfpc</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/nabrosok.html" class="h-link">набросок</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/google.html" class="h-link">google</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/blender.html" class="h-link">blender</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/oshibka.html" class="h-link">ошибка</a>                </li>                <li>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/radost.html" class="h-link">радость</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/iandeks.html" class="h-link">Яндекс</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/javascript.html" class="h-link">javascript</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/eda.html" class="h-link">еда</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/bredni.html" class="h-link">бредни</a>                </li>                <li>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/bge.html" class="h-link">bge</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/zhizn.html" class="h-link">жизнь</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/ia.html" class="h-link">Я</a>                    <a rel="nofollow" class="tag-1" href="http://imdagger.github.io/tag/python.html" class="h-link">python</a>                    <a rel="nofollow" class="tag-2" href="http://imdagger.github.io/tag/linux.html" class="h-link">linux</a>                </li>            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">типам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a rel="nofollow" href="http://imdagger.github.io/category/description.html" class="h-link">обращение</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/friend.html" class="h-link">дружба</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/join.html" class="h-link">клубы</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/link.html" class="h-link">ссылки</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/mood.html" class="h-link">настроение</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/photo.html" class="h-link">фото</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/text.html" class="h-link">текст</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/video.html" class="h-link">видео</a><li>
                <li><a rel="nofollow" href="http://imdagger.github.io/category/wishlist.html" class="h-link"></a><li>
            </ul>
        </div>
    </span>
</div>
    <div class="row b-post">
<div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2011/04/24/cycles/" >
                24 апреля 2011 года, 16:54
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/radost.html">радость</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/cycles.html">cycles</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2011/04/24/cycles/">Cycles</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Новый Cycles это будет нечто! Крутота! /me пляшет от радости.</p>
<div class="text-center"><div class="youtube" align="left"></div><iframe width="450" height="370" src="https://www.youtube.com/embed/8KgrBjt4e9k" frameborder="0"></iframe></div>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2011/03/08/cegui-i-bge-ketsji/" >
                8 марта 2011 года, 14:05
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/cegui.html">CEGUI</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/interfeis.html">интерфейс</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/uluchshenie.html">улучшение</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/razrabotka.html">разработка</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/dobavka.html">добавка</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2011/03/08/cegui-i-bge-ketsji/">CEGUI и BGE Ketsji</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>MyGUI 3.0.1 собирался легко и быстро, но почему-то напрочь отказался
работать в режиме OpenGL платформы без всяких глюков. При добавлении его
в Blender и простой инициализации уже валился сам Blender. Ещё я нашёл
там ошибки в обработке opendir под Linux под OpenGL платформу, в функции
проверки <em>NULL</em> стоял только комментарий и не было <strong>return</strong>, маска
_mask вообще не учитывалась и от этого DataManager никогда не находил
ресурсы и говорил not found :(. Поэтому я решил попробовать CEGUI 0.7.5,
благо я его лет 5 назад собирал, когда была версия 0.4. Как бонус идёт
то, что есть стандартные биндинги для Python.</p>
<p>Собралась библиотека без особых проблем, даже на GCC 3.4.6 (пару
микроскопических правок исходников только пришлось сделать). И главное,
что скомпилились демки (в MyGUI они только под винду компилятся) и я
смог их глянуть. Оттуда я вырезал нужные мне участки кода, и разбросал в
Ketsji коде.</p>
<p>Запускаю Blender нажимаю <kbd class="kbd">
P</kbd>
… бах упало, смотрю, а оно не смогло
инициализировать ресурсы, понимаю, что не всё перенёс. Добавляю
инициализацию ресурсов, запсукаю.. нажимаю <kbd class="kbd">
P</kbd>
.. и бах.. ничего не
появилось и не упало. Понимаю, что Ketsji Render сделал Swap Buffers.
Добавляю отрисовку кадра в нужное место, запускаю.. нажимаю <kbd class="kbd">
P</kbd>
..
барабанная дробь… ура! появилось чёрное GUI :D</p>
<p>Почему было оно чёрное?… Ах, я забыл перед отрисовкой GUI сделать
<code class="code">
glDisable(GL _LIGHTING)</code>
. Он нужен самому движку, но для интерфейса
нужен режим без освещения, вот что получилось:</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/345418/"><img alt="image0" src="http://img-fotki.yandex.ru/get/6003/imdagger.9/0_5454a_a0d6305_L" title="image0"/></a></p>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/04/11/novyi-bild/" >
                11 апреля 2010 года, 20:22
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/sborka.html">сборка</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/forum.html">форум</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2010/04/11/novyi-bild/">Новый билд</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>&nbsp; &nbsp; Завёл себе отдельную
&nbsp;<a class="reference external" href="http://blender3d.org.ua/forum/game/145.html">ветку</a> на форуме
BlenderУкраина. Туда буду выкладывать ссылки на билды, а сюда всякие
мысли и информацию по использованию. Второй
<a class="reference external" href="http://blender3d.org.ua/forum/game/145.html#1">пост</a> вообще должен
был быть про новый билд, но.. Яндекс.Народ почему-то сейчас принимает
файл так доооо..лго.. Говорит 58 минут ждать, но я сейчас столько ждать
не могу, поэтому пойду домой, а ссылку получу завтра и кину на форум
отдельным постом.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/03/11/dinamicheskaia-zagruzka-iz-skriptov/" >
                11 марта 2010 года, 14:50
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2010/03/11/dinamicheskaia-zagruzka-iz-skriptov/">Динамическая загрузка из скриптов</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Добавил в BGE вызов функций отложенной загрузки объектов сцены из
другого blend-файла, а также функцию отложенной выгрузки. До этого можно
было лишь пользоваться актуатором:</p>
<div class="highlight"><pre><span class="pgcss-n">cc</span> <span class="pgcss-o">=</span> <span class="pgcss-n">GameLogic</span><span class="pgcss-o">.</span><span class="pgcss-n">getCurrentController</span><span class="pgcss-p">()</span>
<span class="pgcss-n">blend_loader</span> <span class="pgcss-o">=</span> <span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">actuators</span><span class="pgcss-p">[</span><span class="pgcss-s">&#39;load&#39;</span><span class="pgcss-p">]</span>
<span class="pgcss-n">blend_loader</span><span class="pgcss-o">.</span><span class="pgcss-n">scene</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&#39;Room stuff&#39;</span>
<span class="pgcss-n">room_number</span> <span class="pgcss-o">=</span> <span class="pgcss-mi">112</span>
<span class="pgcss-n">blend_loader</span><span class="pgcss-o">.</span><span class="pgcss-n">blendFileName</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&#39;//room</span><span class="pgcss-si">%s</span><span class="pgcss-s">/stuff/main.blend&#39;</span> <span class="pgcss-o">%</span> <span class="pgcss-n">room_number</span>
<span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">activate</span><span class="pgcss-p">(</span><span class="pgcss-n">blend_loader</span><span class="pgcss-p">)</span>
</pre></div>
<p>blend_loader загрузит сцену из файла с относительным путём
<strong>//room112/stuff/main.blend</strong>,&nbsp;<strong>blendFileName</strong> это свойство,
которое указывает имя файла. так способом можно загружать за одну
итерацию BGE только количество сцен равное количеству активированных
актуаторов. С выгрузкой аналогично. Такой подход может быть удобным,
если нужно по мере загрузки обновлять изображение на экране и
отрисовывать, например полосу прогресса загрузки.</p>
<p>Но бывает нужно за один подход загрузить несколько групп объектов.
Немноог напоминает транзакции из баз данных, т.е. ничего не должно
вклиниваться между загрузкой двух сцен, ни отрисовка, ни другие события
актуаторов или сенсоров. Эту проблему решит добавка отдельного API для
загрузки не через актуаторы:</p>
<div class="highlight"><pre><span class="pgcss-n">room_file_name</span> <span class="pgcss-o">=</span> <span class="pgcss-s">&#39;//room</span><span class="pgcss-si">%s</span><span class="pgcss-s">/stuff/main.blend&#39;</span>
<span class="pgcss-n">room_number</span> <span class="pgcss-o">=</span> <span class="pgcss-mi">112</span>
<span class="pgcss-n">GameLogic</span><span class="pgcss-o">.</span><span class="pgcss-n">mergeBlendFile</span><span class="pgcss-p">(</span><span class="pgcss-s">&#39;Room Stuff&#39;</span><span class="pgcss-p">,</span> \
             <span class="pgcss-s">&#39;//room</span><span class="pgcss-si">%s</span><span class="pgcss-s">/stuff/main.blend&#39;</span> <span class="pgcss-o">%</span> <span class="pgcss-n">room_number</span><span class="pgcss-p">)</span>
 <span class="pgcss-n">room_number</span> <span class="pgcss-o">=</span> <span class="pgcss-mi">115</span>
 <span class="pgcss-n">GameLogic</span><span class="pgcss-o">.</span><span class="pgcss-n">unmergeBlendFile</span><span class="pgcss-p">(</span><span class="pgcss-s">&#39;Room Stuff&#39;</span><span class="pgcss-p">,</span> \
             <span class="pgcss-n">room_file_name</span> <span class="pgcss-o">%</span> <span class="pgcss-n">room_number</span><span class="pgcss-p">,</span> <span class="pgcss-bp">True</span><span class="pgcss-p">)</span>
</pre></div>
<p>Т.е. в сцену, где расположен объект, на котором исполняется данных
скрипт контроллера, добавить объекты из сцены&nbsp;Room
Stuff&nbsp;//room112/stuff/main.blend <u class="underline">
на следующей итерации</u>
. И тут же
потребовать выгрузки на следующей итерации сцены
из&nbsp;//room115/stuff/main.blend, True указывает, что это <strong>Forced</strong> режим
(когда BGE пробудет удалить и blend-файл из памяти, если никто его не
использует). False — обычный режим, BGE удаляет объекты, но blend-файл
оставляет в памяти, чтобы в следующий раз не считывать с диска (вдруг
его опять скоро попросят загрузиться).</p>
<p>Нужно учитывать, что загрузка и выгрузка происходят на новой
итерации, но… проверка при выгрузке происходит сразу. Т.е., если
попросить загрузить <strong>A</strong> и тут же попросить выгрузить <strong>A</strong>, то
загрузка будет (на новой итерации), а при выгрузке скажет, что файл ещё
не загрузился (сразу после исполнения функции).</p>
<p>Соберусь с силами и сделаю ещё один билд. Нужно подправить
функционал связанный с оверлеями :) Я рассчитываю его тоже включить в
сборку.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-video">
    <div class="panel-heading b-post-type b-post-type-video">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
вывесил видео        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/02/05/chernovoi-variant-x-ray/" >
                5 февраля 2010 года, 13:44
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/skrinkasting.html">скринкастинг</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/x-ray.html">x-ray</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span></div>
            </noindex>
            <div class="post-title">
Черновой вариант X-Ray            </div>
            <div class="row post-body">
                <div class="b-text">
<div class="text-center"><div class="yavideo" align="left"></div><object id="flash" width="450" height="370" data="http://flv.video.yandex.ru/lite/imdagger/8djwqarlop.1311/" type="application/x-shockwave-flash"><param value="http://flv.video.yandex.ru/lite/imdagger/8djwqarlop.1311/" name="movie"><param value="high" name="quality"><param value="transparent" name="wmode"><param value="#ffffff" name="bgcolor"><param value="true" name="allowfullscreen"><param value="sameDomain" name="allowscriptaccess"><param value="scale" name="scale"></object></div><p>Сделал вчера этот X-Ray, пока работает не полностью так хорошо, как я
хотел был, но видео записал и вцелом доволен :). Еёщ не работает
непрозрачность, фильтры и установка из свойства, приоритеты работают, но
если приоритеты одинаковые, то проявляется неадекватное поведение
оверлейных объектов (выводится один поверх другого в зависимоти от
порядка добавки, а не от дальности). Есть над чем ещё поработать и
поработать старательно.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/02/04/a-larchik-prosto-otkryvalsia/" >
                4 февраля 2010 года, 16:16
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/x-ray.html">x-ray</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2010/02/04/a-larchik-prosto-otkryvalsia/">А ларчик просто открывался</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Сел вчера ночью дома за машинку. Решил основательно потестировать,
почему код, который я добавляю в отрисовку в Blender с трафаретным
буфером не работает. Написал малюсенький кусочек кода для включения
GL_STENCIL_TEST и вывода треугольника, отключил вывод мешей самого
Ketsji. Включил функцию GL_NEVER, что означало, что я хочу использовать
трафарет, но мне нужно изображение на экране. И я получил такой же
результат, как на работе — изображение выводилось и игнорировало то, что
мне нужна проверка трафарета. Тогда я добавил после каждой gl-функции
строчку <code class="code">
printf(&quot;%d \n&quot;, glGetError());</code>
. И о чудо! Я увидел код
ошибки 1280 для glEnable(GL_STENCIL_TEST), а для включения функций
были ошибки 1282. Вторая ошибка меня не смутила — мало ли, она гласит,
что это неверная операция или невозможна в данном контексте. А вот
первая посеяла в моём мозгу мысль: «Не может быть! Это же значит, что я
передал неверную константу, но она же определена в заголовочном файле
для драйвера карты!».</p>
<p>Ещё больше меня смущало, что тест трафарета работает на моих
отдельных примерах. Но… все они создавали окно при помощи GLUT. Я нашёл
какой-то завалявшийся пример в /usr/share/doc на Perl’е для OpenGL через
SDL и добавил туда проверку трафарета. И.. опять таже ошибка, хотя на
работе Mesa говорит всё время, что ошибки нет. Самое главное и общее тут
выходит — трафарет не работает.</p>
<p>Хорошенько выспавшись я осознал, что &nbsp;нужно искать, где Blender
создаёт окно для вывода контекста. Я рылся в <strong>blender/source</strong> и ничего
не мог найти подходящего. Но потом я нашёл весь платформозависимой код в
<strong>blender/intern/ghost</strong>. Это был файл GHOST_WindowX11.cpp (для винды —
GHOST_WindowWin32.cpp).</p>
<p>И стоило сказать волшебное слово <code class="code">
attributes[i++] =
GLX _STENCIL _SIZE; attributes[i++] = 1;</code>
 — и проверка трафарета
заработала, потому что я включил при создании окна эту возможность.
Аналогично в файле для Win32 нужно подправить массив параметров для
создания окна.</p>
<p>P.S. Ура! Значит скоро обещанный X-Ray в BGE заработает.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/01/31/pamiatka/" >
                31 января 2010 года, 19:57
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/pamiatka.html">памятка</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2010/01/31/pamiatka/">Памятка</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>&nbsp; &nbsp; Нужно сегодня ночью отладить дома функционал с трафаретом для
оверлейных объектов. А завтра уже смогу сделать скринкаст, чтобы
показать возможности :).</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/01/29/overleinye-obekty/" >
                29 января 2010 года, 20:50
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2010/01/29/overleinye-obekty/">Оверлейные объекты</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Добавил обработку, чтобы индекс и непрозрачность можно было
установить из свойства объекта. Оверлей заработал, но пока он как-то
странно реагирует на всё. Т.е. игнорирует всех и выводится всегда поверх
всех.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/129682/"><img alt="image0" src="http://img-fotki.yandex.ru/get/3912/imdagger.5/0_1fa92_1caba2b4_L" title="image0"/></a></p>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/01/25/overlay-objects-early/" >
                25 января 2010 года, 21:09
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/x-ray.html">x-ray</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2010/01/25/overlay-objects-early/">Оверлейные объекты</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Добавил классу RAS_MeshSlot приватное свойство m_iOverlay типа
int. Оно означает оверлейный индекс меша для отрисовки. Если значение 0
— то трафарет не требуется и такой объект сам не является оверлейным и
запрещает отрисовку сквозь себя оверлейных объектов. Следующий индекс —
1, такие объекты разрешают оверлейным прорисовываться сквозь них. Все
индексы со второго по 255 — простые индексы для оверлейных объектов. Чем
выше индекс, тем приоритетнее отрисовка. В Blender индексы будут
выбираться с 0 по 253, но в BGE будут передаваться со смещением +2. Т.к.
glClear заполняет буфер трафарета нулями, а мне требуется чтобы всё
свободное пространство не реагировало на оверлеи по умолчанию, то
логично было отдать этот индекс для «непроницаемых». Но если
использовать функцию <code class="code">
GL _GREATER</code>
, то буфер будет перезаписываться,
поэтому нужно использовать <code class="code">
GL _LESS</code>
 и для всех объектов с индексом <strong>i</strong>
задействовать индекс <code class="code">
256 - i</code>
 для трафарета.</p>
<p>Цикл отрисовки в RAS_BucketManager пришлось чуть усложнить: после
отрисовки m_SolidBuckets и m_AlphaBuckets очищается буфер глубины,
включается режим рендеринга только оверлейных объектов и запускается
заново отрисовка&nbsp;m_SolidBuckets и m_AlphaBuckets.</p>
<p>Думаю завтра или после завтра уже сделаю тестовый образец с X-Ray,
который можно будет оценить :).</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="http://imdagger.github.io/author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="http://imdagger.github.io/posts/2010/01/21/trafaret/" >
                21 января 2010 года, 19:19
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="http://imdagger.github.io/author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
            <noindex>
<div class="row tags-row">
    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/blender.html">blender</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti.html">возможности</a></span>,    <span class="tag"><a rel="nofollow" class="h-link" href="http://imdagger.github.io/tag/bge.html">bge</a></span></div>
            </noindex>
            <div class="post-title">
<a class="no-link" href="http://imdagger.github.io/posts/2010/01/21/trafaret/">Трафарет</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Книжку я свою по OpenGL дома не нашёл, времени искать было мало.
Поэтому стал искать в Интернете наугад то, что мне нужно для реализации
X-Ray с возможностью указывать приоритет по индексу и прозрачностью.
Оказалось это функции управления трафаретом
<code class="code">
glStencilFunc</code>
/<code class="code">
glStencilOp</code>
 и т.д. При чём вот
<a class="reference external" href="http://www.opengl.org.ru/books/open_gl/chapter4.12.html">тут</a>
красиво всё на русском языке изложено. В моём мозгу собралась такая
идейка как поправить <em>RAS_BucketManager</em> и <em>RAS_OpenGLRasterizer</em>. В
растеризер я добавлю включение и выключение трафарета, т.к. все основные
вызовы OpenGL по отрисовке происходят в этом классе и его наследниках.
Менеджер групп объектов я переделаю так, что он будет на вызов
Renderbuckets рисовать не только списки m_SolidBuckets и
m_AlphaBuckets, но и m_OverlayBuckets. Т.к. функция OrderBuckets
сортирует по дальности группы и вычисляет расстояния до камеры, то я
смогу отсекать отрисовку ненужных оверлеев и перебрасывать их в обычный
режим. Вот что происходит при отрисовке, когда есть оверлейные объекты:</p>
<ol class="arabic simple">
<li>Включается трафарет</li>
<li>Отрисовывается  m_SolidBuckets и m_AlphaBuckets, когда рендерится
объект, которому разрешено показывать сквозь себя оверлейные объекты,
то в трафарете эти места помечаются индексами 1000</li>
<li>Переключается режим трафарета, если индекс в буффере больше, чем
объекта</li>
<li>Начинается отрисовка оверлейных объектов</li>
<li>Происходит обход от индекса 0 и по нарастающей</li>
<li>Если индекс изменился, то происходит очистка Z-буффера</li>
<li>Объекты отрисовываются, но индекс в трафарет записывается как 1000 -
index - 1, если это удовлетворяет функции проверки трафарета</li>
<li>Выключается трафарет</li>
</ol>
<p>А ещё я сегодня подумал и взял самое лучше из вчерашней темы, что
поставил и темы Oceanic, вот теперь я доволен, а то оранжевый текст на
моём мониторе не достаточно контрастирует с серым фоном меню. Посмотрим…
пока я доволен, но ещё нужно посмотреть как оно у меня дома на ЖК-шке
смотрится.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/126349/"><img alt="image0" src="http://img-fotki.yandex.ru/get/4010/imdagger.5/0_1ed8d_db9ff3_L" title="image0"/></a></p>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div>        <div class="panel panel-default">
            <div class="panel-body more">
                <span class="more-next"><a class="h-link" href="http://imdagger.github.io/tag/vozmozhnosti2.html">Ещё записи</a></span>
            </div>
        </div>
    </div>
</div>
        </div>
    </body>
</html>