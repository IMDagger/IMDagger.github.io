<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <title>IMDagger: Дневник</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta name="author" content="Alex Moiseenko" />
        <!-- Open Graph -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="stylesheet" href="/theme/css/html4css1.css" />
        <link rel="stylesheet" href="/theme/css/style.css" />
        <link rel="stylesheet" href="/theme/css/pygment.css" />
        <link rel="stylesheet" href="/theme/css/math.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script type="text/x-mathjax-config">
         MathJax.Hub.Config({
             'HTML-CSS': {
                 linebreaks: {
                     automatic: true,
                     width: 'container'
                 }
             },
             tex2jax: {
                 inlineMath: [['$math$','$/math$']],
                 displayMath: [['$$math$$','$$/math$$']],
                 skipTags: ['pre', 'code'],
                 preview: ['формула...'],
                 ignoreClass: 'math-ignore'
             }
         });
        </script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>


        <script src="http://s3.amazonaws.com/nwapi/nwmatcher/nwmatcher-1.2.5-min.js"></script>
        <!--[if (gte IE 6)&(lte IE 8)]>
          <script type="text/javascript" src="/theme/js/selectivizr-min.js"></script>
          <noscript><link rel="stylesheet" href="[fallback css]" /></noscript>
        <![endif]-->

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="row page-head">
            <div class="row page-head-status page-head-status-top"><div class="col-sm-12 b-status mine"><p><i></i><a href="#" title="настроение" class="b-consistent-link"><b>ни к чему чужое мнение, в моде самовыражение</b></a></p></div></div>
            <div class="col-sm-2 page-left">
                <a href="#">
                    <img src="http://upics.yandex.ru/22199227/normal" ilo-full-src="http://upics.yandex.ru/22199227/normal">
                </a>
            </div>
            <div class="col-sm-10 all-posts">
                <div class="title-container">
                    <h1><b><a href="http://imdagger.github.io/" class="fn nickname">IMDagger</a></b></h1>
                </div>
                <div class="title-menu">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="active">
                            <a href="#">Дневник</a>
                        </li>
                        <li><a href="#">О себе</a></li>
                        <li><a href="#">Фотки</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row page-body">
<div class="col-sm-2 page-left">
<div class="row widget widget-photo">
    <a href="posts/2011/08/07/aga-popalsia/" class="b-user-photo__link"><img class="b-user-photo__img" src=" http://img-fotki.yandex.ru/get/5409/22199227.a/0_625fc_e780ccc7_L
?log_nocount=64720402854"></a>
</div><div class="row widget">
    <div class="widget-content b-user-info">
        <div class="widget__body">
            <div class="widget-user-info__age">
                <i class="widget-user-info__sex widget-user-info__sex_type_"></i> 26&nbsp;лет
            </div>
            <div class="widget-user-info__place">
                <a href="#">Гомель</a>,                <a href="#">Беларусь</a>            </div>
            <ul class="contacts">
                <li class="contact contact-type-email"><i></i><a href="mailto:imdagger@yandex.ru">imdagger@yandex.ru</a></li>
                <li class="contact contact-type-ya-online"><i></i>imdagger@ya.ru</li>
                <li class="contact contact-type-icq"><i></i>350395088</li>
            </ul>
        </div>
    </div>
</div>

<div class="row widget">
    <div class="widget-content">
        <div class="widget__title">
            <div class="widget__title-link">Популярное в дневнике</div>
        </div>
        <div class="widget__body">
            <div class="widget-line">
                <div class="widget-entry">
                    <div class="widget-day__title">25&nbsp;июня</div>
                    <div class="widget-entry clearfix">
                        <div class="widget-entry__item">
                            <div class="widget-entry__title">
                                <a href="#" class="h-link">&nbsp;&nbsp;&nbsp; Висцеральная теория сна выглядит стр…</a>
                            </div>
                            <div class="widget-entry__info">2&nbsp;ответа</div>
                        </div>
                    </div>
                </div>
                <div class="widget-entry">
                    <div class="widget-day__title">16&nbsp;мая</div>
                    <div class="widget-entry clearfix">
                        <div class="widget-entry__item">
                            <div class="widget-entry__title">
                                <a href="#" class="h-link">Пожалуй у ByFly сегодня даже более серьё…</a>
                            </div>
                            <div class="widget-entry__info">2&nbsp;ответа</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div></div>

<div class="col-sm-10 all-posts">
<div class="row b-post-filter">
    <span class="pull-right">
        записи по
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">месяцам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a href="#" class="h-link">Нулябрь</a><li>
                <li><a href="#" class="h-link">Первябрь</a><li>
            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">меткам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">                <li>                    <a class="tag-1" href="/tag/radost.html" class="h-link">радость</a>                    <a class="tag-2" href="/tag/sborka.html" class="h-link">сборка</a>                    <a class="tag-2" href="/tag/icfpc.html" class="h-link">icfpc</a>                    <a class="tag-1" href="/tag/ia.html" class="h-link">Я</a>                    <a class="tag-1" href="/tag/zhizn.html" class="h-link">жизнь</a>                </li>                <li>                    <a class="tag-1" href="/tag/rabota.html" class="h-link">работа</a>                    <a class="tag-2" href="/tag/bredni.html" class="h-link">бредни</a>                    <a class="tag-1" href="/tag/programmirovanie.html" class="h-link">программирование</a>                    <a class="tag-2" href="/tag/linux.html" class="h-link">linux</a>                    <a class="tag-2" href="/tag/javascript.html" class="h-link">javascript</a>                </li>                <li>                    <a class="tag-1" href="/tag/python.html" class="h-link">python</a>                    <a class="tag-2" href="/tag/emacs.html" class="h-link">emacs</a>                    <a class="tag-2" href="/tag/java.html" class="h-link">java</a>                    <a class="tag-2" href="/tag/eda.html" class="h-link">еда</a>                    <a class="tag-1" href="/tag/oshibka.html" class="h-link">ошибка</a>                </li>                <li>                    <a class="tag-1" href="/tag/blender.html" class="h-link">blender</a>                    <a class="tag-2" href="/tag/iandeks.html" class="h-link">Яндекс</a>                    <a class="tag-1" href="/tag/bge.html" class="h-link">bge</a>                    <a class="tag-1" href="/tag/nabrosok.html" class="h-link">набросок</a>                    <a class="tag-2" href="/tag/google.html" class="h-link">google</a>                </li>            </ul>
        </div> ·
        <div class="btn-group">
            <span type="button" class="pseudo-link" data-toggle="dropdown">типам</span>
            <ul class="dropdown-menu dropdown-menu-right" role="menu">
                <li><a href="/category/description.html" class="h-link">обращение</a><li>
                <li><a href="/category/friend.html" class="h-link"></a><li>
                <li><a href="/category/join.html" class="h-link"></a><li>
                <li><a href="/category/link.html" class="h-link">ссылки</a><li>
                <li><a href="/category/mood.html" class="h-link">настроение</a><li>
                <li><a href="/category/photo.html" class="h-link">фото</a><li>
                <li><a href="/category/text.html" class="h-link">текст</a><li>
                <li><a href="/category/video.html" class="h-link">видео</a><li>
                <li><a href="/category/wishlist.html" class="h-link"></a><li>
            </ul>
        </div>
    </span>
</div>
    <div class="row b-post">
<div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/12/27/dinamicheskaia-zagruzka-v-bge/" >
                27 декабря 2009 года, 20:14
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/zagruzka.html">загрузка</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/12/27/dinamicheskaia-zagruzka-v-bge/">Динамическая загрузка в BGE</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>&nbsp; &nbsp; Сделал небольшой пример, как динамически загружать объекты уровней в
BGE и как превратить редактор Blender в редактор игровых уровней, а не
только статики и динамики с сохранением в blend. Попробую на днях
подробнее описать, как я перехватываю сохранение и загрузку и управляю
этим процессом. Пока что выложил черновой пример на
<a class="reference external" href="http://blender3d.org.ua">blender3d.org.ua</a>. Посмотрим, если тема
будет интересна и актуальна, то напишу небольшой урок, как производить
загрузку по локациям и не хранить меши всех объектов в памяти.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/12/02/kartinki-v-scripts-window/" >
                2 декабря 2009 года, 13:55
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span>,    <span class="tag"><a class="h-link" href="/tag/last_gateway_to_hell.html">last_gateway_to_hell</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/12/02/kartinki-v-scripts-window/">Картинки в Scripts Window</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Сделал вспомогательный класс для возможности показа в редакторе
изображений текстур с объектов. Это нужно для удобства добавки предметов
в рюкзак воинов, т.к. весь Blender нам служит не только просто
графическим редактором, но и игровым редактором. Переодическия дописываю
в наше меню новые возможности, которые должны облегчить жизнь при
создание игрового мира.</p>
<p class="cut"><a class="h-link reference internal" href="#cut_70602256"data-toggle="collapse">посмотреть класс</a></p>
<div class="collapse" id="cut_70602256">
<div class="highlight"><pre><span class="pgcss-c"># -*- coding: utf-8 -*-</span>
<span class="pgcss-kn">from</span> <span class="pgcss-nn">Blender.BGL</span> <span class="pgcss-kn">import</span> <span class="pgcss-n">glEnable</span><span class="pgcss-p">,</span> <span class="pgcss-n">glBlendFunc</span><span class="pgcss-p">,</span>\
    <span class="pgcss-n">glRasterPos2f</span><span class="pgcss-p">,</span> <span class="pgcss-n">glDrawPixels</span><span class="pgcss-p">,</span> <span class="pgcss-n">glDisable</span>
<span class="pgcss-kn">from</span> <span class="pgcss-nn">Blender.BGL</span> <span class="pgcss-kn">import</span> <span class="pgcss-n">GL_BLEND</span><span class="pgcss-p">,</span> <span class="pgcss-n">GL_BYTE</span><span class="pgcss-p">,</span> <span class="pgcss-n">GL_SRC_ALPHA</span><span class="pgcss-p">,</span>\
    <span class="pgcss-n">GL_ONE_MINUS_SRC_ALPHA</span><span class="pgcss-p">,</span> <span class="pgcss-n">GL_UNSIGNED_BYTE</span><span class="pgcss-p">,</span> <span class="pgcss-n">GL_RGBA</span>
<span class="pgcss-kn">from</span> <span class="pgcss-nn">Blender.BGL</span> <span class="pgcss-kn">import</span> <span class="pgcss-n">Buffer</span>
<span class="pgcss-kn">from</span> <span class="pgcss-nn">Blender</span> <span class="pgcss-kn">import</span> <span class="pgcss-n">Draw</span>

<span class="pgcss-k">class</span> <span class="pgcss-nc">TextureImage</span><span class="pgcss-p">(</span><span class="pgcss-nb">object</span><span class="pgcss-p">):</span>
    <span class="pgcss-sd">&#39;&#39;&#39;</span>
<span class="pgcss-sd">    Класс, объекты которого могут отрисовывать изображения</span>
<span class="pgcss-sd">    текстур в окне для скриптов, при помощи которых они</span>
<span class="pgcss-sd">    инициализировались.</span>

<span class="pgcss-sd">    Свойства:</span>
<span class="pgcss-sd">    - Ширина</span>
<span class="pgcss-sd">    - Высота</span>
<span class="pgcss-sd">    Методы:</span>
<span class="pgcss-sd">    - Отображение в заданных координатах</span>
<span class="pgcss-sd">    &#39;&#39;&#39;</span>

    <span class="pgcss-k">def</span> <span class="pgcss-nf">__init__</span><span class="pgcss-p">(</span><span class="pgcss-bp">self</span><span class="pgcss-p">,</span> <span class="pgcss-n">texture</span><span class="pgcss-p">):</span>
        <span class="pgcss-sd">&#39;&#39;&#39;</span>
<span class="pgcss-sd">        Инициализирует объект оболочку для отрисовки</span>
<span class="pgcss-sd">        текстуры в окне для скриптов.</span>

<span class="pgcss-sd">        :Parameters:</span>
<span class="pgcss-sd">        `texture` : Blender.Texture.Texture</span>
<span class="pgcss-sd">        &#39;&#39;&#39;</span>
        <span class="pgcss-n">image</span> <span class="pgcss-o">=</span> <span class="pgcss-n">texture</span><span class="pgcss-o">.</span><span class="pgcss-n">getImage</span><span class="pgcss-p">()</span>
        <span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">width</span><span class="pgcss-p">,</span> <span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">height</span> <span class="pgcss-o">=</span> <span class="pgcss-n">image</span><span class="pgcss-o">.</span><span class="pgcss-n">size</span>
        <span class="pgcss-n">wh_rgba_size</span> <span class="pgcss-o">=</span> <span class="pgcss-n">image</span><span class="pgcss-o">.</span><span class="pgcss-n">size</span> <span class="pgcss-o">+</span> <span class="pgcss-p">[</span><span class="pgcss-mi">4</span><span class="pgcss-p">]</span>
        <span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">_buffer</span> <span class="pgcss-o">=</span> <span class="pgcss-n">Buffer</span><span class="pgcss-p">(</span><span class="pgcss-n">GL_BYTE</span><span class="pgcss-p">,</span> <span class="pgcss-n">wh_rgba_size</span><span class="pgcss-p">)</span>
        <span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">_copy_from</span><span class="pgcss-p">(</span><span class="pgcss-n">image</span><span class="pgcss-p">)</span>

    <span class="pgcss-k">def</span> <span class="pgcss-nf">_copy_from</span><span class="pgcss-p">(</span><span class="pgcss-bp">self</span><span class="pgcss-p">,</span> <span class="pgcss-n">image</span><span class="pgcss-p">):</span>
        <span class="pgcss-sd">&#39;&#39;&#39;</span>
<span class="pgcss-sd">        Копирует RGBA-данные из исходного изображения</span>
<span class="pgcss-sd">        в специальный буффер попиксельно.</span>

<span class="pgcss-sd">        :Parameters:</span>
<span class="pgcss-sd">        `image` : Blender.Image.Image</span>
<span class="pgcss-sd">        Исходное изображение</span>
<span class="pgcss-sd">        &#39;&#39;&#39;</span>
        <span class="pgcss-n">w</span><span class="pgcss-p">,</span> <span class="pgcss-n">h</span> <span class="pgcss-o">=</span> <span class="pgcss-n">image</span><span class="pgcss-o">.</span><span class="pgcss-n">size</span>
        <span class="pgcss-nb">buffer</span> <span class="pgcss-o">=</span> <span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">_buffer</span>
        <span class="pgcss-k">for</span> <span class="pgcss-n">y</span> <span class="pgcss-ow">in</span> <span class="pgcss-nb">xrange</span><span class="pgcss-p">(</span><span class="pgcss-n">h</span><span class="pgcss-p">):</span>
            <span class="pgcss-k">for</span> <span class="pgcss-n">x</span> <span class="pgcss-ow">in</span> <span class="pgcss-nb">xrange</span><span class="pgcss-p">(</span><span class="pgcss-n">w</span><span class="pgcss-p">):</span>
                <span class="pgcss-nb">buffer</span><span class="pgcss-p">[</span><span class="pgcss-n">y</span><span class="pgcss-p">][</span><span class="pgcss-n">x</span><span class="pgcss-p">][:]</span> <span class="pgcss-o">=</span> <span class="pgcss-n">image</span><span class="pgcss-o">.</span><span class="pgcss-n">getPixelI</span><span class="pgcss-p">(</span><span class="pgcss-n">x</span><span class="pgcss-p">,</span> <span class="pgcss-n">y</span><span class="pgcss-p">)</span>

    <span class="pgcss-k">def</span> <span class="pgcss-nf">draw</span><span class="pgcss-p">(</span><span class="pgcss-bp">self</span><span class="pgcss-p">,</span> <span class="pgcss-n">x</span><span class="pgcss-p">,</span> <span class="pgcss-n">y</span><span class="pgcss-p">):</span>
        <span class="pgcss-sd">&#39;&#39;&#39;</span>
<span class="pgcss-sd">        Отображает в окне в заданных координатах</span>
<span class="pgcss-sd">        изображение, которым было сконструировано.</span>

<span class="pgcss-sd">        :Parameters:</span>
<span class="pgcss-sd">        `x` : int</span>
<span class="pgcss-sd">        Координата по оси X, задана в пикселях</span>
<span class="pgcss-sd">        `y` : int</span>
<span class="pgcss-sd">        Координата по оси Y, задана в пикселях</span>
<span class="pgcss-sd">        &#39;&#39;&#39;</span>
        <span class="pgcss-n">glEnable</span><span class="pgcss-p">(</span><span class="pgcss-n">GL_BLEND</span><span class="pgcss-p">)</span>
        <span class="pgcss-n">glBlendFunc</span><span class="pgcss-p">(</span><span class="pgcss-n">GL_SRC_ALPHA</span><span class="pgcss-p">,</span> <span class="pgcss-n">GL_ONE_MINUS_SRC_ALPHA</span><span class="pgcss-p">)</span>
        <span class="pgcss-c"># правый нижний угол изобрадения</span>
        <span class="pgcss-n">glRasterPos2f</span><span class="pgcss-p">(</span><span class="pgcss-n">x</span><span class="pgcss-p">,</span> <span class="pgcss-n">y</span><span class="pgcss-p">)</span>
        <span class="pgcss-n">glDrawPixels</span><span class="pgcss-p">(</span><span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">width</span><span class="pgcss-p">,</span> <span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">height</span><span class="pgcss-p">,</span> <span class="pgcss-n">GL_RGBA</span><span class="pgcss-p">,</span>\
        <span class="pgcss-n">GL_UNSIGNED_BYTE</span><span class="pgcss-p">,</span> <span class="pgcss-bp">self</span><span class="pgcss-o">.</span><span class="pgcss-n">_buffer</span><span class="pgcss-p">)</span>
        <span class="pgcss-n">glDisable</span><span class="pgcss-p">(</span><span class="pgcss-n">GL_BLEND</span><span class="pgcss-p">)</span>
</pre></div>
</div>
<p>Теперь можно достаточно просто использовать этот класс.
Инициализируется он объектом класса текстуры, поддерживает функционал
вывода на экран этого изображения. Идея взята из класса luxImage. Можно
сделать, например, так:</p>
<div class="highlight"><pre><span class="pgcss-n">bow1_texture</span> <span class="pgcss-o">=</span> <span class="pgcss-n">bpy</span><span class="pgcss-o">.</span><span class="pgcss-n">data</span><span class="pgcss-o">.</span><span class="pgcss-n">textures</span><span class="pgcss-p">[</span><span class="pgcss-s">&#39;Bow1ItemImage&#39;</span><span class="pgcss-p">]</span>
<span class="pgcss-n">bow1_image</span> <span class="pgcss-o">=</span> <span class="pgcss-n">TextureImage</span><span class="pgcss-p">(</span><span class="pgcss-n">bow1_texture</span><span class="pgcss-p">)</span>
<span class="pgcss-k">def</span> <span class="pgcss-nf">gui</span><span class="pgcss-p">():</span>
    <span class="pgcss-n">bow1_image</span><span class="pgcss-o">.</span><span class="pgcss-n">draw</span><span class="pgcss-p">(</span><span class="pgcss-mi">510</span><span class="pgcss-p">,</span> <span class="pgcss-mi">10</span><span class="pgcss-p">)</span>
    <span class="pgcss-n">bow1_image</span><span class="pgcss-o">.</span><span class="pgcss-n">draw</span><span class="pgcss-p">(</span><span class="pgcss-mi">10</span><span class="pgcss-p">,</span> <span class="pgcss-mi">10</span><span class="pgcss-p">)</span>
<span class="pgcss-k">def</span> <span class="pgcss-nf">event</span><span class="pgcss-p">(</span><span class="pgcss-n">evt</span><span class="pgcss-p">,</span> <span class="pgcss-n">value</span><span class="pgcss-p">):</span>
    <span class="pgcss-k">if</span> <span class="pgcss-n">evt</span> <span class="pgcss-o">==</span> <span class="pgcss-n">Draw</span><span class="pgcss-o">.</span><span class="pgcss-n">ESCKEY</span><span class="pgcss-p">:</span>
        <span class="pgcss-n">Draw</span><span class="pgcss-o">.</span><span class="pgcss-n">Exit</span><span class="pgcss-p">()</span>
        <span class="pgcss-k">return</span>
    <span class="pgcss-o">...</span>
<span class="pgcss-n">Draw</span><span class="pgcss-o">.</span><span class="pgcss-n">Register</span><span class="pgcss-p">(</span><span class="pgcss-n">gui</span><span class="pgcss-p">,</span> <span class="pgcss-n">event</span><span class="pgcss-p">,</span> <span class="pgcss-bp">None</span><span class="pgcss-p">)</span>
</pre></div>
<p>Залил ревизию <strong>166</strong> :P, а в глобальном масштабе <strong>265</strong>.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/11/26/baga-s-242-po-25/" >
                26 ноября 2009 года, 20:20
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/oshibka.html">ошибка</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/11/26/baga-s-242-po-25/">Бага с 2.42 по 2.5</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>При поиске ошибки перерыл исходники в svn за различные года (да… в
те года я уже использовал Blender, но даже не знал зачем этот
«фиолетовый человечек из пакмана» по F4). Выяснил, что в 2.40 пришёл на
смену Sumo движок Bullet, до версии 2.42 в Blender не было у Bulltet
Rigid Body, только в Sumo. Потом появился Rigid Body, но метод
переключения setRigidBody забыли поправить. В версии 2.5 таже проблема
(это я изучал исходники trunk из svn). Вот как выглядит сейчас trunk:</p>
<div class="highlight"><pre><span class="pgcss-kt">void</span> <span class="pgcss-n">KX_BulletPhysicsController</span><span class="pgcss-o">::</span><span class="pgcss-n">setRigidBody</span><span class="pgcss-p">(</span><span class="pgcss-kt">bool</span> <span class="pgcss-n">rigid</span><span class="pgcss-p">)</span>
 <span class="pgcss-p">{</span>
 <span class="pgcss-p">}</span>
</pre></div>
<p>А мне кажется, что должно быть:</p>
<div class="highlight"><pre><span class="pgcss-kt">void</span> <span class="pgcss-n">KX_BulletPhysicsController</span><span class="pgcss-o">::</span><span class="pgcss-n">setRigidBody</span><span class="pgcss-p">(</span><span class="pgcss-kt">bool</span> <span class="pgcss-n">rigid</span><span class="pgcss-p">)</span>
 <span class="pgcss-p">{</span>
    <span class="pgcss-n">BulletPhysicsController</span><span class="pgcss-o">::</span><span class="pgcss-n">setRigidBody</span><span class="pgcss-p">(</span><span class="pgcss-n">rigid</span><span class="pgcss-p">);</span>
 <span class="pgcss-p">}</span>
</pre></div>
<p>Чёрт! Знаю, где ошибка, знаю как исправить ошибку, но не хочу
регистрироваться в трекере на blender.org, не хочу качать тонну
исходников из svn и компилировать :(. Надеюсь мне помогут и кто-нибудь,
уже зарегистрированный там и выкачавший svn, поможет отпостить патч.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/11/24/track-to/" >
                24 ноября 2009 года, 18:01
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/python.html">python</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span>,    <span class="tag"><a class="h-link" href="/tag/track-to.html">track to</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/11/24/track-to/">Track to</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Сегодня смастерил маленький пример, как в BGE сделать, чтобы один
объект «следил» за другими. При этом поворачивался в сторону ближайшего.
Все объекты, за которыми нужно наблюдение являются динамическими с
физикой. Сначала я добавил в сцену три кубика, для которых включил
физику, из-за неё они стали падать вниз. Затем конус следящий за
кубиками:</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/103542/"><img alt="Конус" src="http://img-fotki.yandex.ru/get/3904/imdagger.4/0_19476_6e5def42_XL" title="Конус"/></a></p>
<p>Кубики в логике не нуждаются, а вот для конуса добавил логические
кирпичики. Сенсор <code class="code">
object detect</code>
 определяет, что объекты попали в зону
видимости в 30.0 единиц. Python-скрипт <code class="code">
orient</code>
 выбирает объект, на
который нужно ориентироваться и присваивает его в свойство <code class="code">
object</code>

актуатора <code class="code">
track to</code>
. Нужно только учитывать, что у актуатора вида <code class="code">
Edit
Object</code>
 с <code class="code">
Track to</code>
 свойство object принимает именно объекты, а не
строковые имена. Хотя в логических блоках <code class="code">
OB</code>
 принимает названия
объектов.</p>
<p class="cut"><a class="h-link reference internal" data-toggle="collapse" href="#cut_54756048">ещё блоки и управляющий скрипт</a></p>
<div class="collapse" id="cut_54756048">
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/103545/"><img alt="Брики" src="http://img-fotki.yandex.ru/get/4101/imdagger.4/0_19479_da052e6a_L" title="Брики"/></a></p>
<p>Важно не забыть включить свойство <strong>3D</strong>, чтобы объект следил в
пространстве, а не по одной оси. Название объекта вписывать не
обязательно, т.к. сценарий его сам выбирает. Код скрипта <em>orient</em>
представлен ниже:</p>
<div class="highlight"><pre><span class="pgcss-n">cc</span> <span class="pgcss-o">=</span> <span class="pgcss-n">GameLogic</span><span class="pgcss-o">.</span><span class="pgcss-n">getCurrentController</span><span class="pgcss-p">()</span>
<span class="pgcss-n">objects_detected</span> <span class="pgcss-o">=</span> <span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">sensors</span><span class="pgcss-p">[</span><span class="pgcss-s">'object detect'</span><span class="pgcss-p">]</span>
<span class="pgcss-n">x</span><span class="pgcss-p">,</span> <span class="pgcss-n">y</span><span class="pgcss-p">,</span> <span class="pgcss-n">z</span> <span class="pgcss-o">=</span> <span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">owner</span><span class="pgcss-o">.</span><span class="pgcss-n">position</span>

<span class="pgcss-k">if</span> <span class="pgcss-n">objects_detected</span><span class="pgcss-o">.</span><span class="pgcss-n">positive</span><span class="pgcss-p">:</span>
    <span class="pgcss-n">min_dist</span> <span class="pgcss-o">=</span> <span class="pgcss-bp">None</span>
    <span class="pgcss-n">closest</span> <span class="pgcss-o">=</span> <span class="pgcss-bp">None</span>

    <span class="pgcss-n">around</span> <span class="pgcss-o">=</span> <span class="pgcss-n">objects_detected</span><span class="pgcss-o">.</span><span class="pgcss-n">hitObjectList</span>
    <span class="pgcss-k">for</span> <span class="pgcss-n">obj</span> <span class="pgcss-ow">in</span> <span class="pgcss-n">around</span><span class="pgcss-p">:</span>
        <span class="pgcss-n">ox</span><span class="pgcss-p">,</span> <span class="pgcss-n">oy</span><span class="pgcss-p">,</span> <span class="pgcss-n">oz</span> <span class="pgcss-o">=</span> <span class="pgcss-n">obj</span><span class="pgcss-o">.</span><span class="pgcss-n">position</span>
        <span class="pgcss-n">dist</span> <span class="pgcss-o">=</span> <span class="pgcss-p">((</span><span class="pgcss-n">x</span> <span class="pgcss-o">-</span> <span class="pgcss-n">ox</span><span class="pgcss-p">)</span> <span class="pgcss-o">**</span> <span class="pgcss-mi">2</span> <span class="pgcss-o">+</span> <span class="pgcss-p">(</span><span class="pgcss-n">y</span> <span class="pgcss-o">-</span> <span class="pgcss-n">oy</span><span class="pgcss-p">)</span> <span class="pgcss-o">**</span> <span class="pgcss-mi">2</span> <span class="pgcss-o">+</span> <span class="pgcss-p">(</span><span class="pgcss-n">z</span> <span class="pgcss-o">-</span> <span class="pgcss-n">oz</span><span class="pgcss-p">)</span> <span class="pgcss-o">**</span> <span class="pgcss-mi">2</span><span class="pgcss-p">)</span> <span class="pgcss-o">**</span> <span class="pgcss-mf">0.5</span>

        <span class="pgcss-k">if</span> <span class="pgcss-n">min_dist</span> <span class="pgcss-ow">is</span> <span class="pgcss-ow">not</span> <span class="pgcss-bp">None</span><span class="pgcss-p">:</span>
            <span class="pgcss-k">if</span> <span class="pgcss-n">min_dist</span> <span class="pgcss-o">&gt;</span> <span class="pgcss-n">dist</span><span class="pgcss-p">:</span>
                <span class="pgcss-n">min_dist</span> <span class="pgcss-o">=</span> <span class="pgcss-n">dist</span>
                <span class="pgcss-n">closest</span> <span class="pgcss-o">=</span> <span class="pgcss-n">obj</span>
            <span class="pgcss-k">else</span><span class="pgcss-p">:</span>
                <span class="pgcss-n">min_dist</span> <span class="pgcss-o">=</span> <span class="pgcss-n">dist</span>
                <span class="pgcss-n">closest</span> <span class="pgcss-o">=</span> <span class="pgcss-n">obj</span>

        <span class="pgcss-k">if</span> <span class="pgcss-n">closest</span><span class="pgcss-p">:</span>
            <span class="pgcss-n">lookat</span> <span class="pgcss-o">=</span> <span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">actuators</span><span class="pgcss-p">[</span><span class="pgcss-s">'track to'</span><span class="pgcss-p">]</span>
            <span class="pgcss-n">lookat</span><span class="pgcss-o">.</span><span class="pgcss-n">object</span> <span class="pgcss-o">=</span> <span class="pgcss-n">closest</span>
            <span class="pgcss-n">cc</span><span class="pgcss-o">.</span><span class="pgcss-n">activate</span><span class="pgcss-p">(</span><span class="pgcss-n">lookat</span><span class="pgcss-p">)</span>
</pre></div>
</div>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/11/16/dvoinoe-vysvobozhdenie-pamiati/" >
                16 ноября 2009 года, 18:21
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/oshibka.html">ошибка</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span>,    <span class="tag"><a class="h-link" href="/tag/sdl.html">SDL</a></span>,    <span class="tag"><a class="h-link" href="/tag/radost.html">радость</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/11/16/dvoinoe-vysvobozhdenie-pamiati/">Двойное высвобождение памяти</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Эта небольшая проблема началась дома где-то 1-1,5 года назад. Т.к.
это не единственная рабочая лошадка, то бага не тревожила. Ещё тогда
после какого-то обновления часть программ стала выпадать с ошибкой (это
были в основном игры), но меня это не огорчило. Потом обнаружил, что
если собрать BGE-игру в отдельный файл и запустить, то выпадает ошибка:</p>
<blockquote>
<div class="line-block">
<div class="line">*** glibc detected *** double free or corruption (out):
0xbf9819c0 ***</div>
<div class="line">Аварийный останов</div>
</div>
</blockquote>
<p>И вот вчера почему-то уже и в самом Blender перестал работать
нормально запуск по <strong>P</strong>. Я решил разобраться с проблемой. Раньше я уже
как-то смотрел и выдвинул длся себя предположение об ошибке в SDL, я
обновлял его до версии 1.2.11. Только я думал, что это связано со
звуком.</p>
<p>Но вчера я пошёл путём методичного поиска точки с ошибкой и
бэктрэйсом стека:</p>
<div class="highlight"><pre><span class="pgcss-gp">#</span> в одной консоли:
<span class="pgcss-gp">$</span> ./blender

<span class="pgcss-gp">#</span> в другой:
<span class="pgcss-gp">$</span> gdb -pid <span class="pgcss-sb">`</span>ps -e | grep blender | awk <span class="pgcss-s1">&#39; print {$1} &#39;</span><span class="pgcss-sb">`</span>
<span class="pgcss-go">(gdb) bt</span>

<span class="pgcss-gp">#</span> … тут было про стек, free и… SDL_syscdrom.c …
</pre></div>
<p>“Странно, отладчик показывает не в SDL_mixer, значит это не звук”,
- подумал я. Стал смотреть код и отлаживать (перед этим собраз SDL с
<strong>-g3</strong>), нашёл неправильное высвобождение памяти в <strong>CheckMounts</strong>.
Память под mnt_dev и mnt_type выделяла SDL_stack_alloc, а
высвободить пытались при помощи SDL_free. И это ж надо!.. у меня как
раз supermount для cdrom и в этом коде ошибка. Я исправил исходник:</p>
<div class="highlight"><pre><span class="pgcss-gh">diff -rupN SDL-1.2.11-orig/src/cdrom/linux/SDL_syscdrom.c</span>
SDL-1.2.11/src/cdrom/linux/SDL_syscdrom.c
— SDL-1.2.11-orig/src/cdrom/linux/SDL_syscdrom.c 2009-11-16
01:13:05.000000000 +0200
<span class="pgcss-gi">+++ SDL-1.2.11/src/cdrom/linux/SDL_syscdrom.c 2009-11-16</span>
01:04:07.000000000 +0200
<span class="pgcss-gu">@@ -218,7 +218,7 @@ static void CheckMounts(const char *mtab</span>
           if ( SDL_strcmp(mnt_type, MNTTYPE_SUPER) == 0 ) {
              tmp = SDL_strstr(mntent-&gt;mnt_opts, &quot;fs=&quot;);
              if ( tmp ) {
<span class="pgcss-gd">-                SDL_free(mnt_type);</span>
<span class="pgcss-gi">+                SDL_stack_free(mnt_type);</span>
                 mnt_type = SDL_strdup(tmp + SDL_strlen(&quot;fs=&quot;));
                 if ( mnt_type ) {
                     tmp = SDL_strchr(mnt_type, &#39;,&#39;);
<span class="pgcss-gu">@@ -229,7 +229,7 @@ static void CheckMounts(const char *mtab</span>
              }
              tmp = SDL_strstr(mntent-&gt;mnt_opts, &quot;dev=&quot;);
              if ( tmp ) {
<span class="pgcss-gd">-                SDL_free(mnt_dev);</span>
<span class="pgcss-gi">+                SDL_stack_free(mnt_dev);</span>
                 mnt_dev = SDL_strdup(tmp + SDL_strlen(&quot;dev=&quot;));
                 if ( mnt_dev ) {
                     tmp = SDL_strchr(mnt_dev, &#39;,&#39;);
</pre></div>
<p>А так, проблема эта уже давно решена в SDL версии выше 1.2.11.
Просто у меня не было возможности обновится в прошлую ночь, да и
прикольно решить несложную задачку по отлову баги за минут 20-30. После
правки и пересборки BGE заработал, а в довесок и набор игр :).</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/11/12/proekt/" >
                12 ноября 2009 года, 19:53
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/proekt.html">проект</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span>,    <span class="tag"><a class="h-link" href="/tag/last_gateway_to_hell.html">last_gateway_to_hell</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/11/12/proekt/">Проект</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Мысли для себя:</p>
<p>Думаю проект разродится в ближайшем обозримом будущем, что-то типа альфа
версии с именем <strong>Last Gateway to hell</strong>, и в репозиторий в этот день
будет занесён тег last_gateway_to_hell. Тут вот Many создал интерфейс
обмена предметами и код для работы с ним, я код контроллеров для
взаимодействия интерфейса с моделями рюкзака, тела и комбослотов.</p>
<p class="cut"><a class="h-link reference internal" data-toggle="collapse" href="#cut_60787408">тоже интересно, что там я написал</a></p>
<div class="collapse" id="cut_60787408">
<p>Поправил в его сцене некоторые вещи, которые напомню ему: сделать
относительный путь к текстуре (начинающийся со <strong>//</strong>), переименовать
сцену в BagScene, центрировать камеру, сместить одну кнопку (он помнит
про неё). Вот с этой кнопочкой вышел казус… я сразу и не въехал, как
поправить проблему. Смещаешь ryjgre, а после запуска BGE она становится
на своё место. Оказалось, что для неё кроме ключа масштабировани
сохранена позиция по X и Y. В режиме <em>IPO Curve Editor</em> я выделил эти
кривые и при помощи клавиши <strong>X</strong> удалил.</p>
<p>Белые полупрозрачные квадратики — это для отладки, чтобы видеть
область возможного нажатия и выбора.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/99779/"><img alt="image0" src="http://img-fotki.yandex.ru/get/4000/imdagger.4/0_185c3_21c60b05_L" title="image0"/></a></p>
</div>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/11/11/volna/" >
                11 ноября 2009 года, 20:39
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/volna.html">волна</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/11/11/volna/">Волна</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Вдохновлённый волнами вдруг задумался, а как можно нарисовать в 3D
волну в BGE. Придумал такую схему: есть небольшой кусочек волны
(плоскость), есть генератор волны (например Empty), генератор создаётся
новые объекты при помощи instantAddObject, но перед этим смещает все
существующие и убирает лишние.</p>
<p>После этого эксперимента я понял, как побороть ошибку, что объект в
BGE уже уничтожен, а Python-ссылка ведёт в никуда. Оказалось:</p>
<blockquote>
<div class="line-block">
<div class="line"># нужно проверить флаг <em>invalid</em> перед работой с BGE-объектом</div>
<div class="line">for obj in …</div>
<div class="line">&nbsp; &nbsp;if not <strong>obj.invalid</strong>:</div>
<div class="line">&nbsp; &nbsp; &nbsp; &nbsp;…</div>
</div>
</blockquote>
<p>Ролик, который просто демонстрирует, как я сижу за компьтером и делаю
сцену, и запускаю BGE (волны движутся так медленно потому, что записывал
с частотой <strong>4 кадра в секунду</strong>):</p>
<div class="text-center"><div class="yavideo" align="left"></div><object id="flash" width="450" height="370" data="http://flv.video.yandex.ru/lite/imdagger/1uwv46vaaj.604/" type="application/x-shockwave-flash"><param value="http://flv.video.yandex.ru/lite/imdagger/1uwv46vaaj.604/" name="movie"><param value="high" name="quality"><param value="transparent" name="wmode"><param value="#ffffff" name="bgcolor"><param value="true" name="allowfullscreen"><param value="sameDomain" name="allowscriptaccess"><param value="scale" name="scale"></object></div><p>Резкий подкат камеры к зелёной «плоскости» — режим работы с
объектом, когда все остальные пропадают, а изображение выбранного
масштабируется под область видимости (делается при помощи клавиши
<kbd class="kbd">
/</kbd>
, и туда и обратно).</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/11/06/kosti/" >
                6 ноября 2009 года, 20:58
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/skrinkasting.html">скринкастинг</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span>,    <span class="tag"><a class="h-link" href="/tag/kost.html">кость</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/11/06/kosti/">Кости</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Из-за немощности моего рабочего компа (в остновном я его использую,
как терминалку к серверам) пришлось найти компромис между большими
объёмами данных (и потерями при запими на винчестер) и процессорным
временем на сжатие. Как наиболее оптимальный я выбрал <em>qtrle</em>. Опция
<strong>xga</strong> указывает на разрешение записываемого ролика, т.е. 1024x768.
Опция <em>-r</em> задаёт частоту записи равную 4 кадрам в секунду (замедления
ощущаются, но они равномерные, а не рывками как при recordmydesktop).
Устройство для захвата это X-овая сессия <strong>:0.0</strong>, кодек для захвата
x11grab (должен присутствовать в ffmpeg -formats).</p>
<blockquote>
<strong>ffmpeg -f x11grab -s xga -r 4 -i :0.0 -vcodec qtrle result.mov</strong></blockquote>
<p>На выходе получился ролик приблизительно 34МiB. И
продолжительностью около 4 минут. Я решил перекодировать его другим
кодеком, который хорошо сожмёт, но не потребует изменения масштаба или
создаст сильную потерю качества. Кодек mpeg4 “набросал много грязи”, а
h264 потребовал другое соотношение сторон. Но я заметил в списке
поддерживаемых (ffmpeg -formats) кодек для flash.</p>
<blockquote>
<strong>ffmpeg -ss 2 -t 00:03:57 -i result.mov -vcodec flashsv
result2.flv</strong></blockquote>
<p>Он сжал ролик до 7MiB. Меня это удовлетворяло и он оставил качество
на таком уровне, что когда я смотрел, то на пару секунд забыл, что это
видео, а не живая система:</p>
<div class="yavideo" align="center"><object id="flash" width="450" height="338" data="http://flv.video.yandex.ru/lite/imdagger/m4sjpx6t7h.1108/" type="application/x-shockwave-flash"><param value="http://flv.video.yandex.ru/lite/imdagger/m4sjpx6t7h.1108/" name="movie"><param value="high" name="quality"><param value="transparent" name="wmode"><param value="#ffffff" name="bgcolor"><param value="true" name="allowfullscreen"><param value="sameDomain" name="allowscriptaccess"><param value="scale" name="scale"></object></div><p>Сначала я создаю основу Body, затем две кости Left и Right, но
убираю ссылку на предка. Переворачиваю их и устанавливаю ограничители
такие, чтобы «ножки смотрели» всегда на основу и далеко не отрывались.</p>
<p>P.S. Курсор у меня в системе на самом деле чёрный с белой окантовкой, но
он аппаратный, поэтому ffmpeg создаёт свой при записи, который белый с
чёрной каймой.</p>
                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/11/05/sglazhivanie/" title="изменено 14 июля 2014 года в 04:49">
                5 ноября 2009 года, 19:19
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span>,    <span class="tag"><a class="h-link" href="/tag/sglazhivanie.html">сглаживание</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/11/05/sglazhivanie/">Сглаживание</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Только обратил внимание на кнопку <strong>Set Smooth</strong> в Blender.
Оказалось, что оно и в BGE работает, производит расчёт освещённости
каждого полигона поверхности меша на основании соседних. Думаю, что для
достаточно гладких поверхностей мне эта возможность в BGE очень даже
пригодится, а то приходилось «одевать» текстуру высокополигонального
объекта даже при минимальной необходимости.</p>
<p>Для примера я создал обычную UV-сферу 32 на 32.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98456/"><img alt="image0" src="http://img-fotki.yandex.ru/get/4000/imdagger.4/0_18098_c848c4e1_L" title="image0"/></a></p>
<p class="cut text-center"><a class="h-link reference internal" data-toggle="collapse" href="#cut_69395536">смотреть дальше</a></p>
<div class="collapse" id="cut_69395536">
<p>Затем выделил левую половину сферы</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98457/"><img alt="image1" src="http://img-fotki.yandex.ru/get/4105/imdagger.4/0_18099_c16429b_L" title="image1"/></a></p>
<p>Нажал кнопку Set Smooth (вкладка Editing по <kbd class="kbd">
F9</kbd>
), которая
применила сглаживание освещения для выбранных полигонов:</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98459/"><img alt="image2" src="http://img-fotki.yandex.ru/get/4002/imdagger.4/0_1809b_59d09d3_L" title="image2"/></a></p>
<p>При переходе обратно в объектный режим результат изменений стал
сразу же очевиден:</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98460/"><img alt="image3" src="http://img-fotki.yandex.ru/get/3905/imdagger.4/0_1809c_528821a6_L" title="image3"/></a></p>
<p>При этом, в игровом режиме BGE сфера отображалась таким же образом,
т.е. такой тип расчёта освещения допускал и внутренний игровой движок.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98461/"><img alt="image4" src="http://img-fotki.yandex.ru/get/4105/imdagger.4/0_1809d_d711d4cd_L" title="image4"/></a></p>
<p>Но мне показалось этого мало :). Я решил создать два меша типа
<strong>Monkey</strong> и поэкспериментировать с ними. Слева и справа два абсолюто
идентичных объекта.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98462/"><img alt="image5" src="http://img-fotki.yandex.ru/get/4106/imdagger.4/0_1809e_c095fd3d_L" title="image5"/></a></p>
<p>Но к левой обезьянке затем был применён Set Smooth и запущен BGE.</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98463/"><img alt="image6" src="http://img-fotki.yandex.ru/get/4106/imdagger.4/0_1809f_d25dd552_L" title="image6"/></a></p>
<p>Ещё лучше стала видна разница после применения к обоим мешам
модификатора SubSurf всего лишь 1-ого уровня (на рисунке включён Shaded
Draw Type).</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/98465/"><img alt="image7" src="http://img-fotki.yandex.ru/get/3906/imdagger.4/0_180a1_e73f2b5c_L" title="image7"/></a></p>
<p>Нашёл ещё пару ссылок по данной тематике:</p>
<p><a class="reference external" href="http://www.blender.org/documentation/htmlI/x2681.html">Из документации</a></p>
<p><a class="reference external" href="http://feeblemind.tuxfamily.org/dotclear/index.php/2007/08/13/88-how-to-solve-blenders-smoothing-problems">Заметка о возможных проблемах при Set
Smooth</a></p>
</div>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div><div class="panel panel-text">
    <div class="panel-heading b-post-type b-post-type-text">
        <b class="b-user">
            <a class="b-user__link" href="author/imdagger.html"><b class="b-user__first-letter">I</b>MDagger</a>
        </b>
написал        <span class="pull-right b-date">
            <a class="h-link" href="/posts/2009/10/30/resistance/" >
                30 октября 2009 года, 21:33
            </a>
        </span>
    </div>
    <div class="panel-body">
        <div class="col-sm-1 b-post__layout-left">
            <a href="author/imdagger.html"><img src="http://upics.yandex.ru/22199227/middle"></a>
        </div>
        <div class="col-sm-11 b-right-col">
<div class="row tags-row">
    <span class="tag"><a class="h-link" href="/tag/blender.html">blender</a></span>,    <span class="tag"><a class="h-link" href="/tag/bge.html">bge</a></span>,    <span class="tag"><a class="h-link" href="/tag/3d.html">3d</a></span></div>
            <div class="post-title">
<a class="no-link" href="/posts/2009/10/30/resistance/">Resistance</a>            </div>
            <div class="row post-body">
                <div class="b-text">
<p>Хочу сделать в BGE небольшую программку, где игрок будет управлять
переключателем, который ездит вверх и вниз, а на него по плате движутся
различные враги. Движутся они разными способами, но карта разделена на
слоты, т.е. все враги движутся только по слотам. Переключатель отделён
барикадой микросхем от основного поля, он ездит туда-сюда и подаёт
напряжение на некоторые контакты. От этого враги погибают. Если ещё всё
это завуалировать и над каждым врагом приделать маленькую тыквочку, то
тогда можно объяснить, что на материской плате в Хэллоуин все резисторы,
диоды, конденсаторы, микроконтроллеры вышли из под контроля и теперь
процессор в опасности и его защищает простой переключатель. Так они
выглядят увеличенные в игровом режиме BGE:</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/96536/"><img alt="Резистор" src="http://img-fotki.yandex.ru/get/4001/imdagger.3/0_17918_afa194eb_L" title="Резистор"/></a></p>
<p class="text-center">«Мистер-резистор» (у него ещё будет собрат поОмнее)</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/96537/"><img alt="Конденсатор" src="http://img-fotki.yandex.ru/get/4006/imdagger.3/0_17919_5b5054b7_L" title="Конденсатор"/></a></p>
<p class="text-center">Конденсатор. Может заряжаться и перелетать несколько позиций</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/96538/"><img alt="Микросхема" src="http://img-fotki.yandex.ru/get/3804/imdagger.3/0_1791a_8e9345a9_L" title="Микросхема"/></a></p>
<p class="text-center">Микросхема. Нужно уничтожить все ножки</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/96539/"><img alt="Рендер микросхемы" src="http://img-fotki.yandex.ru/get/4003/imdagger.3/0_1791b_f4583791_L" title="Рендер микросхемы"/></a></p>
<p class="text-center">А это рендер микросхемы</p>
<p class="text-center"><a class="reference external" href="http://fotki.yandex.ru/users/imdagger/view/96540/"><img alt="Светодиод" src="http://img-fotki.yandex.ru/get/3906/imdagger.3/0_1791c_e709f896_L" title="Светодиод"/></a></p>
<p class="text-center">Светодиод. Стреляет «лучами смерти»</p>
<p>Даже, если не сделаю (а то времени нынче мало), то хоть модельки
низкополигональные поучусь делать для BGE. Хочу ещё запечь завтра
текстуры с высокополигональных и одеть на эти. Особенно на светодиод :),
а то шероховатый он.</p>                </div>
            </div>
            <div class="row comments-row">
                <span><a class="pseudo-link b-candy b-comment-shortcut"><i class="b-ico"></i>ответить</a></span>
            </div>
        </div>
    </div>
</div>        <div class="panel panel-default">
            <div class="panel-body more">
                <span class="less-prev"><a class="h-link" href="tag/bge5.html">Назад</a></span>
                <span class="more-next"><a class="h-link" href="tag/bge7.html">Ещё записи</a></span>
            </div>
        </div>
    </div>
</div>
        </div>
<!-- Yandex.Metrika informer --><a href="https://metrika.yandex.ru/stat/?id=25746494&amp;from=informer" target="_blank" rel="nofollow"><img src="//bs.yandex.ru/informer/25746494/3_1_FFFFFFFF_EFEFEFFF_0_pageviews" style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" onclick="try{Ya.Metrika.informer({i:this,id:25746494,lang:'ru'});return false}catch(e){}"/></a><!-- /Yandex.Metrika informer --><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter25746494 = new Ya.Metrika({id:25746494, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/25746494" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->    </body>
</html>