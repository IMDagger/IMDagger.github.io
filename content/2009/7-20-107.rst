Добавка множества объектов в BGE
================================
:date: 2009-07-20 13:33:29
:tags: blender, python, bge, добавка, объект
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=107

Меня попросил мой друг Many объяснить ему, как можно в Blender GE
создавать много объектов за один запуск контроллера.Т.к. на словах
объяснять сложно, то он попросил, чтобы я это предоставил в письменной
форме, т.е. в виде небольшого туториала.

И так, приступим. Пусть уже создан объект Cube на втором слое в
Blender (можно и на другом слое, важно, чтобы не на видимом, а то объект
не будет создаваться).

.. cut:: читать далее
   :paragraph: yes

   .. class:: text-center

   |image0|

   Теперь нужно деактивировать второй слой и активировать первый, на
   котором расположен источник света и камера. Пусть требуется создать 64
   объекта кубика, которые будут расположены вдоль окружности радиусом 1Бм
   (Блендер метр) и с центром (0.5; 0.5)Бм.

   Для того, чтобы создавать объекты нужно, чтобы актуатор какого-нибудь
   другого объекта произвёл эти операции. Но нужно, чтобы сам “создатель”
   не отображался, а лишь служил “фабрикой по производству кубиков”. Для
   этого подойдёт тип объекта Empty. Он не отображается в BGE, но все
   операции над ним можно проводить, как с обычным объектом. Добавим его на
   первый слой.

   .. class:: text-center

   |image1|

   Теперь активный слой выглядит так:

   .. class:: text-center

   |image2|

   Изначально по-умолчанию камера повёрнута и смещена от глобального
   центра. Поэтому можно сбросить эти параметры в ноль при помощи :kbd:`Alt+R`
   (вращение) и :kbd:`Alt+G` (смещение). Это можно и не производить, просто
   было бы удобнее, чтобы объекты были расположены по правильной
   окружности, а не в перспективе издалека.

   Теперь можно приступить непосредственно к конструированию логических
   блоков и написанию программного кода. Следует выделить Empty и нажать
   :kbd:`F4`. Таким образом, будет открыт режим редактирования логики объекта.
   Создание “окружности кубиков” должно произойти сразу после запуска
   игрового режима (клавиша :kbd:`P`). Чтобы логический блок выполнился ровно
   один раз, нужно создать сенсор типа Always, у которого выключен *pulse
   mode:*

   .. class:: text-center

   |image3|

   Затем следует добавить контроллер типа Python и указать название
   скрипта (скрипт создаётся в режиме работы с текстом по **Shift+F11**).
   Если название скрипта будет введено неправильно, то Blender обнулит это
   поле и не даст присвоить в него некорректное значение. Сенсор необходимо
   соединить с контроллером.

   .. class:: text-center

   |image4|

   После этого создаётся актуатор типа Edit Object с выбранным Add
   Object. В поле *OB* нужно указать, что объект для добавки - Cube.
   Актуатор не будет вызываться, если только его не активирует код из
   скрипта. Соединение требуется лишь потому, что получить актуатор из
   сценария можно, если он соединён со слотом.

   .. class:: text-center

   |image5|

   Код сценария выглядит таким образом:

   .. code-block:: python

       from math import sin, cos, pi
       cc = GameLogic.getCurrentController()
       a = cc.getActuator('add')
       count = 64
       sector = (2 * pi) / count
       radius = 1.0
       sx, sy = 0.5, 0.5
       for i in xrange(count):
           angle = i * sector
           x = cos(angle) * radius + sx
           y = sin(angle) * radius + sy
           a.instantAddObject()
           obj = a.getLastCreatedObject()
           obj.setPosition([x, y, 0.0])

   Сначала определяется текущий контроллер, в котором исполняется
   сценарий (т.к. один и тот же скрипт можно вызывать из разных
   контроллеров). Затем, используя контроллер, получается актуатор типа
   Edit Object, который был создан ранее в логических блоках. Объявляются
   переменные: count - количество кубиков, sector - угол перемещения
   объекта по окружности в радианах, sx и sy - смещение круга относительно
   системы координат.

   Функция :code:`instantAddObject` объявлена в актуатор, который присоединён
   к слоту контроллера. Она создаёт то, что указано в актуаторе, но не
   после выполнения логической цепи, а непосредственно в момент вызова
   этого метода. Теперь возникает вопрос: “А как получить то, что оно
   создало, если метод ничего не возвращает?”. Для этого существует другой
   метод в актуаторе, который называется :code:`getLastCreatedObject`\ ; т.к. в
   момент работы текущего контроллера никакие другие не исполняются, то эта
   функция, вызванная сразу за :code:`instantAddObject`\ , вернёт как-раз
   созданный объект из-за того, что он последний добавленный.

   .. alert-info::

       **Замечание:** Актуатор добавки объекта создаёт их всегда в той же
       позиции, что и у владельца актуатора. Поэтому для перемещения нужно
       использовать метод setPosition.

   Теперь можно нарисовать систему координат, чтобы было понятно, что
   окружность, вдоль которой расположены объекты, смещена на заданное
   расстояние.

   .. class:: text-center

   |image6|

   После запуска игрового режима можно увидеть результат (файл можно
   скачать
   `тут <https://yadi.sk/d/I-Na-ezsUmdNn>`__):

   .. class:: text-center

   |image7|


.. |image0| image:: http://img-fotki.yandex.ru/get/3508/imdagger.2/0_eb10_e122c2dc_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60176/
.. |image1| image:: http://img-fotki.yandex.ru/get/3513/imdagger.2/0_eb11_60cc8f83_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60177/
.. |image2| image:: http://img-fotki.yandex.ru/get/3508/imdagger.2/0_eb12_2595173d_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60178/
.. |image3| image:: http://img-fotki.yandex.ru/get/3514/imdagger.2/0_eb14_2bdda85_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60180/
.. |image4| image:: http://img-fotki.yandex.ru/get/3512/imdagger.2/0_eb15_2122e075_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60181/
.. |image5| image:: http://img-fotki.yandex.ru/get/3610/imdagger.2/0_eb16_9a2282f3_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60182/
.. |image6| image:: http://img-fotki.yandex.ru/get/3609/imdagger.2/0_eb17_8a15ae0d_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60183/
.. |image7| image:: http://img-fotki.yandex.ru/get/3609/imdagger.2/0_eba8_92ef9603_L
   :target: http://fotki.yandex.ru/users/imdagger/view/60328/
