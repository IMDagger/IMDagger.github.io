Midnight Commander
==================
:date: 2009-08-04 16:31:11
:tags: midnight commander, баг
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=125

Сижу использую Opera, версию вроде свежая. Думаю: “Что-то она сильно
тормозит? :-/” Смотрю в top — процессор нагружен на 100%. Уже начал
грешить на JS на сайте, но вдруг обратил внимание на процесс **./mc**,
который висит себе порождённый от **init** и не подсоединён к терминалу.
И оказывается это он всё время ест! Я стал вспоминать откуда этот
процесс взялся и вспомнил, что в воскресение я скачал 4.7.0 версию и
решил проверить оченб старую, давнюю багу в Midnight Commander.
Оказывается её никто не поправил: создаём папку в одном месте, а файл с
таким же именем в другом, пробуем копировать файл туда же, где и папка —
всё ok (т.е. mc говорит, что это сделать не возможно и я с ним
солидарен). Но стоит порпосить его скопировать :underline:`в фоне`, он сразу рухнет с
segfault, а родительский процесс останется подвисшим.

Когда-то я смотрел ещё старые исходники и нашёл, что mc, чтобы
копировать в фоне делает **fork()**, для работы с основным mc и
отображением всех ошибок в фоне есть специальные функции и структуры,
но… но…!! разработчик фонового копирования их не использовал! Он просто
работал как-будто и не было никакого **fork**! Зайду как-нибудь на
jabber-конференцию текущих разработчиков да скажу им пробаг, а если
появится немного времени свободного от проекта и работы, то сам поправлю
(хотя бывает лень, т.к. я не копирую в фоновом режиме, у меня для этого
обычно несколько mc).

Самое забавное, что Midnight Commander успел наработать 54 :underline:`часа`!!
процессорного времени после segfault его дочернего процесса :D.
