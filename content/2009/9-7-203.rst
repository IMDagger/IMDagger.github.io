Samba4-alpha6 в alpha9
======================
:date: 2009-09-07 21:55:38
:tags: samba4, ошибка, обновление
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=203

Если посчастливилось обновляться с **Samba4** 6-ой альфы на 9-ую, то
следует помнить, что для поддержки **Win2008** появился параметр
**parentGUID**. Т.к. у меня была уже сконфигурированная alpha6 и там уже
было 400 активных пользователей, десятки рабочих машин и где-то ещё 300
не постоянных пользователей, то не хотелось нарушить её
работоспособность. Но при обновлении на **9-ку** появились проблемы с
тем, что она стала загружаться медленнее и перестали вводится машины в
домен с ошибкой "*База данных защиты повреждена*\ " (позднее я выяснил,
что это проблемы со схемой после обновления). Я обратил внимание на
**samba.log** и увидел запись, что в схеме :underline:`отсутствует аттрибут
parentGUID` при попытке добавки новой записи. Это связано с тем, что
**alpha9** обновляет parentGUID, а в схеме его нету (она старая от
6-ки). Тут-то я и осознал, что код Samba я обновил, а **schema.ldb** —
нет. Тогда я выполнил следующие действия:

-  Остановил сервис Samba
-  Переименовал каталоги etc, var и private (:underline:`т.к. сценарий будет
   перезаписывать там данные`)
-  Создал пустые etc, var, private (тут самое важное — пользователи!!)
-  Запустил Python-скрипт **provision** из share/setup

-  Программа создала всё необходимое и конфигурационный файл

Из-за того, что у меня сервер уже был настроен до обновления, то я
заменил только файлы **schema.ldb** и **sam.ldb**. Запустил сервис
Samba4. Больше ошибка с введением в домен *пока не появлялась*.
