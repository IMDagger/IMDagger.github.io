Размял мозг
===========
:date: 2009-10-22 20:01:06
:tags: патч, тикет, midnight commander, копирование
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=359

Пришёл тут rework по поводу моего патча к
`1500 <https://www.midnight-commander.org/ticket/1500>`__ тикету (а я
же не могу спать, когда мои патчи не кормлены), который я когда-то
создавал. Ура! Наконец-то его посмотрели и сказали, что в нём есть
небольшая бага: при попытке перезаписать файл в **фоновом копировании**,
Midnight Commander выводит предупреждение и перезаписывает файл без
запроса к пользователю. Оказалось, что в исходниках просто присваивалось
:code:`ctx->ui = NULL`, если процесс фоновый, в принципе это было отчати
логично, чтобы дочерние процессы сами не пытались отображать информацию.
Поэтому пришлось частично инициализировать этот контекст операции, в
случае do\_bg равного истине, ещё до того, как произошёл fork. Наваял
такой
`патч <https://www.midnight-commander.org/attachment/ticket/1500/background_fix_assert.diff>`__,
буду ждать ответа (или схожу на канал), а то там уже даже ветку
1500\_segfault\_on\_bg\_copy создали, которую я так долго ждал :). Нужно
будет ещё исправить проблему с :kbd:`C-x j`, где-то я накосячил…

Заметил, что все как-то красиво вставляют чейнжсет в **Trac**, а я
не знаю как, поэтому перечитал документацию по работе с его Wiki.
Оказалось, что он сам обнаруживает в тексте упоминания чейнжсетов и
делает ссылки, т.е. пишешь просто
(c75ebb2ab9b9002bc26741968092d32dc048104d), а получаешь:
(`c75ebb2ab9b9002bc26741968092d32dc048104d <https://www.midnight-commander.org/changeset/c75ebb2ab9b9002bc26741968092d32dc048104d>`__).
