Расширение базовых классов в CPython
====================================
:date: 2013-03-12 23:36:22
:tags: патч, type, python, класс, int, базовый, str, модификация
:category: link
:author: IMDagger
:attached-url: https://github.com/gabrielfalcao/sure/blob/master/sure/magic.py
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=1756

В Python, в классической реализации CPython не предусмотрено расширение
базовых классов типа: :code:`type`, :code:`int`, :code:`str`, :code:`dict` и т.д., из соображений
производительности и засорения базовых классов. Но если очень хочется,
то пару хаков и можно за счёт модификации структуры в рабочем
python-процессе разрешить такой функционал (так сделал хакер Lincoln de
Sousa https://github.com/clarete/ ), достаточно посредством ctypes, и
доступного pythonapi в нём, вызвать внутренний метод и пропатчить
базовый класс налету. И тогда можно делать такие штуки (пример из
библиотеки https://github.com/gabrielfalcao/sure для тестов):

.. code-block:: python

   {"foo": 1}.does.have.key("foo").being.with_value.equal(1)

Вообще такое расширение будет работать на страх и риск того, кто
использует. Не знаю как на такие трюки отреарировал бы gevent, uwsgi или
ещё какие библиотеки, которые работают непосредственно с интерпретатором
на низком уровне.
