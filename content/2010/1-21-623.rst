Трафарет
========
:date: 2010-01-21 19:19:12
:tags: blender, возможности, bge
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=623

Книжку я свою по OpenGL дома не нашёл, времени искать было мало.
Поэтому стал искать в Интернете наугад то, что мне нужно для реализации
X-Ray с возможностью указывать приоритет по индексу и прозрачностью.
Оказалось это функции управления трафаретом
:code:`glStencilFunc`\ /\ :code:`glStencilOp` и т.д. При чём вот
`тут <http://www.opengl.org.ru/books/open_gl/chapter4.12.html>`__
красиво всё на русском языке изложено. В моём мозгу собралась такая
идейка как поправить *RAS\_BucketManager* и *RAS\_OpenGLRasterizer*. В
растеризер я добавлю включение и выключение трафарета, т.к. все основные
вызовы OpenGL по отрисовке происходят в этом классе и его наследниках.
Менеджер групп объектов я переделаю так, что он будет на вызов
Renderbuckets рисовать не только списки m\_SolidBuckets и
m\_AlphaBuckets, но и m\_OverlayBuckets. Т.к. функция OrderBuckets
сортирует по дальности группы и вычисляет расстояния до камеры, то я
смогу отсекать отрисовку ненужных оверлеев и перебрасывать их в обычный
режим. Вот что происходит при отрисовке, когда есть оверлейные объекты:

#. Включается трафарет
#. Отрисовывается  m\_SolidBuckets и m\_AlphaBuckets, когда рендерится
   объект, которому разрешено показывать сквозь себя оверлейные объекты,
   то в трафарете эти места помечаются индексами 1000
#. Переключается режим трафарета, если индекс в буффере больше, чем
   объекта
#. Начинается отрисовка оверлейных объектов
#. Происходит обход от индекса 0 и по нарастающей
#. Если индекс изменился, то происходит очистка Z-буффера
#. Объекты отрисовываются, но индекс в трафарет записывается как 1000 -
   index - 1, если это удовлетворяет функции проверки трафарета
#. Выключается трафарет

А ещё я сегодня подумал и взял самое лучше из вчерашней темы, что
поставил и темы Oceanic, вот теперь я доволен, а то оранжевый текст на
моём мониторе не достаточно контрастирует с серым фоном меню. Посмотрим…
пока я доволен, но ещё нужно посмотреть как оно у меня дома на ЖК-шке
смотрится.

.. class:: text-center

|image0|

.. |image0| image:: http://img-fotki.yandex.ru/get/4010/imdagger.5/0_1ed8d_db9ff3_L
   :target: http://fotki.yandex.ru/users/imdagger/view/126349/
