Перехват событий
================
:date: 2010-01-15 18:08:00
:tags: blender, возможности, bge, last_gateway_to_hell
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=600

Мне для замены текущего нестабильного кода в редакторе, который
реализованы через… эм.. скрипты, кучу скриптлинков, которые
устанавливаются и удаляются через … эм.. тоже скрипты, пришлось добавить
пару новых видов скриптлинков: OnBGEStart, OnBGEFinish, OnSpaceAction.
Т.к. перед запуском BGE я хочу убрать все лишние объекты, а игровой
движок сам загрузит карту. После того, как BGE отработал, то хотелось бы
вернуться обратно в режим редактирования карты, поэтому нужно возвратить
всё временно удалённое обратно. Ещё очень хочется, чтобы по привычной
клавише пробел добавлялись не меши, а воины, поэтому я добавил событие
OnSpaceAction, которое перехватывает сценарий. При этом поведение меню
Add в шапке Blender не меняется, только обработчик клавиши пробел.

Когда я добавлял обраточики и менял код, то попался на классическую
ошибку.. эх.. классика. Я достаточно быстро нашёл проблему, но было
приятно встретить классическую ошибку, вот какой я добавил код:

    |     /\* send the OnSpaceAction event \*/
    |     if (G.f & G\_DOSCRIPTLINKS) {
    |         if (BPY\_do\_pyscript(&G.scene->id,
      SCRIPT\_ONSPACEACTION))\ **;**
    |             return; // menu is handled by script
    |     }

А потом сижу и думаю: “Почему код, который идёт после этой проверки
не исполняется. :code:`BPY\_do\_pyscript` же вернул 0, а return сработал… О!! А
что это у нас за точка с запятой в конце оператора :code:`if`??”. Вот такая
классическая ошибка :), точки с запятой не должно быть, просто случайно
поставил.

Теперь я могу добавить в проект эти возможности у убрать старый не
полностью функциональный код из редактора и заменить на такие чудесные
обработчики и результат (запускал BGE, а затем нажимал в объектном
режиме пробел):

.. class:: text-center

|image0|

.. class:: text-center

|image1|

.. |image0| image:: http://img-fotki.yandex.ru/get/4101/imdagger.5/0_1deb3_65249a2_L
   :target: http://fotki.yandex.ru/users/imdagger/view/122547/
.. |image1| image:: http://img-fotki.yandex.ru/get/4100/imdagger.5/0_1deb5_a275f1f9_L
   :target: http://fotki.yandex.ru/users/imdagger/view/122549/
