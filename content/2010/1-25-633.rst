Оверлейные объекты
==================
:date: 2010-01-25 19:09:04
:tags: blender, возможности, bge, x-ray
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=633
:slug: overlay-objects-early

Добавил классу RAS\_MeshSlot приватное свойство m\_iOverlay типа
int. Оно означает оверлейный индекс меша для отрисовки. Если значение 0
— то трафарет не требуется и такой объект сам не является оверлейным и
запрещает отрисовку сквозь себя оверлейных объектов. Следующий индекс —
1, такие объекты разрешают оверлейным прорисовываться сквозь них. Все
индексы со второго по 255 — простые индексы для оверлейных объектов. Чем
выше индекс, тем приоритетнее отрисовка. В Blender индексы будут
выбираться с 0 по 253, но в BGE будут передаваться со смещением +2. Т.к.
glClear заполняет буфер трафарета нулями, а мне требуется чтобы всё
свободное пространство не реагировало на оверлеи по умолчанию, то
логично было отдать этот индекс для «непроницаемых». Но если
использовать функцию :code:`GL\_GREATER`, то буфер будет перезаписываться,
поэтому нужно использовать :code:`GL\_LESS` и для всех объектов с индексом **i**
задействовать индекс :code:`256 - i` для трафарета.

Цикл отрисовки в RAS\_BucketManager пришлось чуть усложнить: после
отрисовки m\_SolidBuckets и m\_AlphaBuckets очищается буфер глубины,
включается режим рендеринга только оверлейных объектов и запускается
заново отрисовка m\_SolidBuckets и m\_AlphaBuckets.

Думаю завтра или после завтра уже сделаю тестовый образец с X-Ray,
который можно будет оценить :).
