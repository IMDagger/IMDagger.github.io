

:date: 2012-12-27 00:59:33
:tags: pymongo, unittests, safe
:category: text
:author: IMDagger
:yaru-link: http://imdagger.ya.ru/replies.xml?item_no=1724
:slug: urn:ya.ru:post/22199227/1724

Чтобы при создание Unit-тестов и использовании стандартной
библиотеки unittests не возникало странных ситуаций при работе с
MongoDB, когда появляются внезапно провалившиеся тесты на ровном месте,
следует во время создания соединения через pymongo указать :code:`safe=True`,
чтобы каждое изменение разблокировало контекст только после ответа об
успешно применённой операции.

    pymongo.connection.Connection(port=config.contentserv.port,
    **safe=True**)

Иначе по-умолчанию изменения отправляются сразу в БД, и клиент не
ожидает подтверждения, что всё хорошо. Что может приводить к неполной
или несвоевременной очистке коллекций между разными тестами.
